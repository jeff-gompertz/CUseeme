<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Thumbnail Recursion 2</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
  }

  /* Canvas layer for trails */
  #trailCanvas {
    position: fixed;
    inset: 0;
    z-index: -1;
  }

  .floating-window {
    position: absolute;
    width: 200px;
    height: 120px;
    overflow: hidden;
    border: none;
    opacity: 0.75; /* semi-translucent */
    box-shadow: 0 0 25px rgba(0,0,0,0.3);
    cursor: grab;
    background: rgba(255,255,255,0.05);
  }

  .floating-window img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    border: none;
  }

  .floating-window:active { cursor: grabbing; }
</style>
</head>
<body>
<canvas id="trailCanvas"></canvas>
<div id="windows"></div>

<script>
const container = document.getElementById("windows");
const canvas = document.getElementById("trailCanvas");
const ctx = canvas.getContext("2d");
let W = window.innerWidth;
let H = window.innerHeight;
canvas.width = W;
canvas.height = H;

window.addEventListener("resize", () => {
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;
});

/* === CONFIG === */
const MAX_WINDOWS = 6;
const KEYWORD = "ghost";  // ðŸ‘ˆ change this word (e.g. "thanks")

/* === RSS fetch === */
const feedUrl =
  "https://www.youtube.com/feeds/videos.xml?channel_id=UCREEmHdAYvlboosrKCHe4UA";

fetch("https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(feedUrl))
  .then(res => res.json())
  .then(data => {
    const items = data.items || [];

    // Filter by keyword if present in title
    let filtered = items.filter(item =>
      item.title && item.title.toLowerCase().includes(KEYWORD.toLowerCase())
    );

    if (!filtered.length) {
      // fallback: take first 15 items and pick random
      filtered = items.slice(0, 15).sort(() => 0.5 - Math.random());
    }

    const videos = filtered.slice(0, MAX_WINDOWS);

    videos.forEach((video) => {
      const vidId = (video.guid || "").split(":").pop();
      const thumb = video.thumbnail || `https://i.ytimg.com/vi/${vidId}/hqdefault.jpg`;

      const div = document.createElement("div");
      div.className = "floating-window";
      div.style.left = Math.random() * (W - 220) + "px";
      div.style.top  = Math.random() * (H - 140) + "px";
      div.innerHTML = `<img src="${thumb}" alt="thumb">`;

      container.appendChild(div);
      makeDrift(div);
    });
  })
  .catch(err => console.error("Feed error:", err));

/* === Drift + Trails === */
const windows = [];
function makeDrift(el) {
  const obj = {
    el,
    x: el.offsetLeft,
    y: el.offsetTop,
    w: el.offsetWidth,
    h: el.offsetHeight,
    vx: (Math.random() * 2 - 1) * 0.7,
    vy: (Math.random() * 2 - 1) * 0.7
  };
  windows.push(obj);
}

function animate() {
  ctx.fillStyle = "rgba(0,0,0,0.15)"; // fade old trails
  ctx.fillRect(0, 0, W, H);

  windows.forEach(obj => {
    if (!obj.dragging) {
      obj.x += obj.vx;
      obj.y += obj.vy;
      if (obj.x <= 0 || obj.x + obj.w >= W) obj.vx *= -1;
      if (obj.y <= 0 || obj.y + obj.h >= H) obj.vy *= -1;
      obj.el.style.left = obj.x + "px";
      obj.el.style.top  = obj.y + "px";
    }

    // Draw trails: current thumbnail
    const img = obj.el.querySelector("img");
    if (img.complete) {
      ctx.globalAlpha = 0.35;
      ctx.drawImage(img, obj.x, obj.y, obj.w, obj.h);
      ctx.globalAlpha = 1.0;
    }
  });

  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
