<!-- === Generative API v1.2 — Dualfetch Mode === -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Generative API v1.2 — Dualfetch Mode</title>
<style>
  html,body{margin:0;height:100%;background:#fff;font-family:monospace;overflow:hidden}

  /* --- Centered prompt --- */
  #promptWrap{position:fixed;inset:0;display:grid;place-items:center;pointer-events:none;z-index:2}
  #promptBox{pointer-events:auto;display:flex;align-items:center;gap:.5rem;
             padding:.6rem 1rem;border-radius:10px;
             background:rgba(255,255,255,.25);border:1px solid rgba(0,0,0,.18)}
  #caret{width:.35ch;height:1.3em;background:#111;animation:blink 1s step-end infinite}
  #input{border:0;outline:0;background:transparent;color:#111;font:inherit;width:18ch}
  #input::placeholder{color:rgba(0,0,0,.35)}
  @keyframes blink{50%{opacity:0}}

  /* --- Ticker Console --- */
  #ticker{
    position:fixed;left:10px;bottom:10px;width:40%;max-height:55%;
    display:flex;flex-direction:column-reverse;overflow:hidden;z-index:3;
    font-size:1.2rem;line-height:1.3rem;color:#FF4433;opacity:.85
  }
  .tline{
    margin:0;opacity:.92;
    animation:fadeIn .9s ease forwards;
    transition:opacity 120s linear;
    white-space:pre-wrap;word-break:break-word
  }
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:.92;transform:translateY(0)}}
</style>
</head>
<body>

<div id="promptWrap">
  <div id="promptBox">
    <div id="caret"></div>
    <input id="input" type="text" spellcheck="false" autocomplete="off" placeholder="type here..." />
  </div>
</div>

<div id="ticker"></div>

<script>
(() => {
  const SITES = [
    'https://jeffgompertz.site',
    'https://art.jeffgompertz.site'
  ];
  const ENDPOINT = (base, q, page=1) =>
    `${base}/wp-json/wp/v2/posts?search=${encodeURIComponent(q)}&per_page=10&page=${page}`;

  const ticker = document.getElementById('ticker');
  const input  = document.getElementById('input');

  function addLine(text){
    const el = document.createElement('div');
    el.className = 'tline';
    el.textContent = text;
    ticker.prepend(el);
    setTimeout(()=>{ el.style.opacity = .15; }, 120000);
    if (ticker.children.length > 120) ticker.removeChild(ticker.lastChild);
  }

  function strip(html){
    const d = document.createElement('div'); d.innerHTML = html;
    return (d.textContent || d.innerText || '').replace(/\s+/g,' ').trim();
  }

  function sentences(s){
    return (s||'').split(/(?<=[\.\!\?])\s+|[\n\r]+/).map(t=>t.trim()).filter(Boolean);
  }

  async function fetchAllSites(word){
    const allLines = [];
    const tasks = SITES.map(async base => {
      try {
        const res = await fetch(ENDPOINT(base, word));
        const posts = await res.json();
        posts.forEach(p=>{
          if (p.title?.rendered)   allLines.push(...sentences(strip(p.title.rendered)));
          if (p.excerpt?.rendered) allLines.push(...sentences(strip(p.excerpt.rendered)));
          if (p.content?.rendered) allLines.push(...sentences(strip(p.content.rendered)).slice(0,6));
        });
      } catch(e){ console.warn(`Fetch error for ${base}`, e); }
    });
    await Promise.all(tasks);
    const uniq = [...new Set(allLines)].filter(l => l.length >= 3 && l.length <= 220);
    return uniq.slice(0, 50);
  }

  async function react(word){
    const lines = await fetchAllSites(word);
    if (!lines.length) return;
    const count = Math.max(3, Math.min(6, lines.length));
    for (let i=0;i<count;i++){
      setTimeout(()=> addLine(lines[i % lines.length]), i*450);
    }
  }

  input.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter'){
      const q = input.value.trim();
      if (!q) return;
      react(q);
      input.select();
    }
  });
})();
</script>

</body>
</html>
