<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Database Recursion — Text Input Stage 1 (White Background)</title>
<style>
  html,body{
    margin:0;padding:0;overflow:hidden;
    background:#fff;color:#000;height:100%;
    font-family:Helvetica,Arial,sans-serif;
  }
  canvas{
    position:fixed;inset:0;width:100%;height:100%;
    z-index:-2;
  }
  #text-feed{
    position:fixed;bottom:0;width:100%;height:100%;
    display:flex;justify-content:center;align-items:flex-end;
    overflow:hidden;z-index:-1;color:#000;
  }
  #feed-content{
    text-align:center;width:80%;
    font-size:1.5rem;line-height:2rem;
  }
  .headline{margin:1rem 0;}
</style>
</head>
<body>
<canvas id="trail"></canvas>
<div id="text-feed"><div id="feed-content"></div></div>

<script>
/* === Simple visible background motion === */
const canvas=document.getElementById("trail");
const ctx=canvas.getContext("2d");
let W=innerWidth,H=innerHeight;
canvas.width=W;canvas.height=H;
addEventListener("resize",()=>{W=innerWidth;H=innerHeight;canvas.width=W;canvas.height=H;});
let t=0;
function draw(){
  t+=0.02;
  ctx.fillStyle="rgba(255,255,255,0.3)";
  ctx.fillRect(0,0,W,H);
  const hue=200+150*Math.sin(t);
  const r=80+60*Math.sin(t*2);
  ctx.beginPath();
  ctx.arc(W/2,H/2,r,0,Math.PI*2);
  ctx.fillStyle=`hsla(${hue},100%,60%,0.2)`;  /* faint pastel pulse */
  ctx.fill();
  requestAnimationFrame(draw);
}
draw();

/* === BBC RSS Text Feed (with guaranteed fallback) === */
const feedURL="https://feeds.bbci.co.uk/news/rss.xml";
const proxy="https://api.allorigins.win/get?url="+encodeURIComponent(feedURL);

fetch(proxy).then(r=>r.ok?r.json():Promise.reject(r)).then(data=>{
  if(!data.contents){throw new Error("Empty feed");}
  const xml=new DOMParser().parseFromString(data.contents,"text/xml");
  const titles=[...xml.querySelectorAll("item>title")].map(t=>t.textContent);
  if(titles.length<3)throw new Error("No titles");
  buildFeed(titles);
}).catch(err=>{
  console.warn("Feed fallback:",err);
  buildFeed([
    "Database Recursion — White Test Mode",
    "External feed blocked → local text layer active",
    "If you can read this, system is functioning"
  ]);
});

function buildFeed(lines){
  const feed=document.getElementById("feed-content");
  feed.innerHTML="";
  lines.forEach(line=>{
    const d=document.createElement("div");
    d.className="headline";
    d.textContent=line;
    feed.appendChild(d);
  });
  startScroll();
}

function startScroll(){
  const content=document.getElementById("feed-content");
  let y=H*0.9;
  function animate(){
    y-=1;
    content.style.transform=`translateY(${y}px)`;
    if(y+content.offsetHeight>0)requestAnimationFrame(animate);
    else{y=H*0.9;requestAnimationFrame(animate);}
  }
  animate();
}
</script>
</body>
</html>
