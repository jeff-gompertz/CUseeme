<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>a_SingleSharedVideoSplitIntoPanels_centerpush_HUDtoggle</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root {
    --hud-bg: rgba(10, 10, 10, 0.7);
    --hud-fg: #e6f3ff;
    --hud-ac: #98d5ff;
  }
  html,body {margin:0;height:100%;background:#000;overflow:hidden;}
  canvas {display:block;touch-action:none;}

  /* --- HUD PANEL --- */
  .hud {
    position: fixed;
    top: 10px; left: 10px;
    z-index: 10;
    padding: 10px 12px;
    border-radius: 8px;
    background: var(--hud-bg);
    color: var(--hud-fg);
    font: 12px/1.4 system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    user-select: none;
    backdrop-filter: blur(6px);
    transition: opacity 0.4s ease, background 0.6s ease;
    opacity: 1;
  }
  .hud.hidden {
    opacity: 0.15;
    pointer-events: none;
  }
  .hud h1 {
    margin: 0 0 8px;
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.04em;
    color: var(--hud-ac);
    text-transform: uppercase;
  }
  .row {
    display: grid;
    grid-template-columns: 110px 1fr 46px;
    gap: 8px;
    align-items: center;
    margin: 6px 0;
  }
  .row label {opacity: .9;}
  .row input[type="range"] {width: 220px;}
  .row output {justify-self:end;min-width:46px;text-align:right;opacity:.9;}
  .btnline {
    display:flex;
    justify-content: space-between;
    align-items:center;
    margin-top:8px;
  }
  .btn {
    background: rgba(255,255,255,.08);
    color: var(--hud-fg);
    border: 1px solid rgba(255,255,255,.16);
    padding: 5px 10px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    letter-spacing: .04em;
  }
  .btn:hover {background: rgba(255,255,255,.14);}
  #flash {
    position: fixed;
    inset: 0;
    background: rgba(255,255,255,0);
    pointer-events: none;
    z-index: 5;
    transition: background 0.5s ease;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="flash"></div>

<div class="hud" id="hud">
  <h1>Control Panel</h1>

  <div class="row">
    <label>NUM_CARDS</label>
    <input type="range" id="numCards" min="4" max="12" value="8" step="1" />
    <output id="numCardsVal">8</output>
  </div>

  <div class="row">
    <label>CENTER_OVERLAP</label>
    <input type="range" id="centerOverlap" min="100" max="400" value="220" step="10" />
    <output id="centerOverlapVal">220</output>
  </div>

  <div class="row">
    <label>ALPHA</label>
    <input type="range" id="alpha" min="0.1" max="1.0" value="0.35" step="0.05" />
    <output id="alphaVal">0.35</output>
  </div>

  <div class="btnline">
    <div>
      <button class="btn" id="toggleHUD">HUD</button>
      <button class="btn" id="resetHUD">RESET</button>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const flash = document.getElementById("flash");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
window.addEventListener("resize",resize);resize();

/* Parameters */
let NUM_CARDS = 8;
let CENTER_OVERLAP = 220;
let ALPHA = 0.35;

/* Sliders */
const hud = document.getElementById("hud");
const sliders = [
  {id:"numCards",var:"NUM_CARDS",out:"numCardsVal"},
  {id:"centerOverlap",var:"CENTER_OVERLAP",out:"centerOverlapVal"},
  {id:"alpha",var:"ALPHA",out:"alphaVal"}
];
sliders.forEach(s=>{
  const input=document.getElementById(s.id);
  const out=document.getElementById(s.out);
  input.addEventListener("input",()=>{
    window[s.var]=parseFloat(input.value);
    out.textContent=input.value;
    initCards();
  });
});

/* Toggle HUD */
let hudVisible=true;
document.getElementById("toggleHUD").onclick=()=>{
  hudVisible=!hudVisible;
  hud.classList.toggle("hidden",!hudVisible);
};

/* Reset defaults + flash */
document.getElementById("resetHUD").onclick=()=>{
  NUM_CARDS=8;CENTER_OVERLAP=220;ALPHA=0.35;
  sliders.forEach(s=>{
    document.getElementById(s.id).value=window[s.var];
    document.getElementById(s.out).textContent=window[s.var];
  });
  flash.style.background="rgba(255,255,255,0.3)";
  setTimeout(()=>flash.style.background="rgba(255,255,255,0)",200);
  initCards();
};

/* Load a random MP4 from WP */
async function loadVideo(){
  const url="https://art.jeffgompertz.site/wp-json/wp/v2/media?per_page=50";
  const r=await fetch(url); const d=await r.json();
  const vids=d.filter(m=>m.mime_type==="video/mp4");
  const pick=vids[Math.floor(Math.random()*vids.length)];
  const v=document.createElement("video");
  v.src=pick.source_url;v.loop=true;v.muted=true;v.playsInline=true;v.preload="auto";
  v.style.display="none";document.body.appendChild(v);
  await new Promise(res=>{v.oncanplay=res;setTimeout(res,1000);});
  v.play().catch(()=>{});
  return v;
}

/* Panel setup */
let cards=[]; let currentVideo=null;
function initCards(){
  const W=canvas.width,H=canvas.height;
  const perSide=NUM_CARDS/2;
  const w=W/2+CENTER_OVERLAP;
  const h=H*1.05;
  cards=[];
  for(let i=0;i<NUM_CARDS;i++){
    const side=i<perSide?"left":"right";
    const t=(i%perSide)/(perSide-1);
    let x;
    if(side==="left"){
      const edge=-60;
      const center=(W/2-w/2)+CENTER_OVERLAP/2;
      x=edge+(center-edge)*t;
    }else{
      const edge=W-w+60;
      const center=(W/2-w/2)-CENTER_OVERLAP/2;
      x=edge+(center-edge)*t;
    }
    cards.push({x,y:0,w,h});
  }
}

/* Draw video */
function drawVideo(v,x,y,w,h,a=1){
  if(!v||v.readyState<2)return;
  const iw=v.videoWidth||v.width,ih=v.videoHeight||v.height;
  const r=Math.max(w/iw,h/ih);
  const nw=iw*r,nh=ih*r;
  const ox=x+(w-nw)/2,oy=y+(h-nh)/2;
  ctx.globalAlpha=a;ctx.drawImage(v,ox,oy,nw,nh);ctx.globalAlpha=1;
}

/* Click â†’ next random video */
canvas.addEventListener("click",async()=>{
  const v=await loadVideo();
  if(v)currentVideo=v;
});

/* Render loop */
function render(){
  ctx.fillStyle="rgba(0,0,0,0.05)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  if(currentVideo){
    for(const c of cards) drawVideo(currentVideo,c.x,c.y,c.w,c.h,ALPHA);
  }
  requestAnimationFrame(render);
}

/* Boot */
(async()=>{
  const v=await loadVideo();
  if(!v){console.warn("No videos");return;}
  currentVideo=v;
  initCards();
  render();
})();
</script>
</body>
</html>
