<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>XY — Full Grid Emulation Baseline</title>
  <style>
    html,body{
      height:100%; margin:0;
      background: #000 !important;
      font-family: "VT323", ui-monospace, Menlo, Consolas, monospace;
      color:#efe; overflow:visible;
    }
    #gridCanvas {
      position:fixed; top:0; left:0; width:100vw; height:100vh;
      z-index: -2; pointer-events:none;
      background: #000 !important;
      display: block;
    }
    .miniWin{
      position:absolute;
      width:66vw; max-width:380px; aspect-ratio:9/12;
      background:rgba(30,30,30,0.88);
      border:1px solid rgba(255,255,255,0.25);
      border-radius:15px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.22);
      overflow:hidden; cursor:grab; z-index:500;
      backdrop-filter:blur(12px);
    }
    .miniWin:active{ cursor:grabbing; }
    .miniBar{
      display:flex; align-items:center; justify-content:space-between;
      padding:5px 10px; height:24px;
      background:rgba(0,0,0,0.10);
      font-size:12px; color: #dde; user-select:none;
    }
    .miniInner{ position:relative; width:100%; height:calc(100% - 24px);}
    .miniVideo{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit:cover; background:#000 !important;
    }
    #hudWrapper{position:fixed;top:16px;left:18px;z-index:100;}
    .hud-row{display:flex;gap:12px;margin-bottom:6px;}
    .hud-btn{flex:1;font-family:"VT323",monospace;font-size:17px;color:#132030;background:rgba(215,235,255,0.28);border:none;border-radius:10px;box-shadow:0 3px 6px rgba(0,0,0,0.16);padding:10px 12px;cursor:pointer;transition:all .22s;}
    #ticker{
      position:fixed; left:16px; bottom:14px; z-index:900;
      width:45vw; max-width:700px; max-height:50vh;
      display:flex; flex-direction:column-reverse; overflow:hidden;
      color:#ff3a2f; font-size:18px; line-height:1.25;
      background: transparent !important;
    }
    .tline{ opacity:.95; margin:0; animation:fadeIn .6s ease; }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
    @media (max-width: 700px) {
      .miniWin { left: 4vw !important; right: auto !important; width: 90vw !important; max-width: 90vw !important;}
      #hudWrapper { left: 4vw !important;}
    }
  </style>
</head>
<body>
  <canvas id="gridCanvas"></canvas>
  <!-- HUD controls -->
  <div id="hudWrapper">
    <div class="hud-row">
      <button class="hud-btn" id="btnSpawn5">➕ Spawn 5</button>
      <button class="hud-btn" id="btnCloseAll">✕ Close All</button>
    </div>
  </div>
  <div id="ticker"></div>
  <script>
    // --- GRID FIELD EMULATION: TD XY mode ---
    // Pure abstract grid: no video/camera background, just an XY mesh/particle/displacement field.
    const gridCanvas = document.getElementById('gridCanvas');
    const gridCtx = gridCanvas.getContext('2d', { alpha: true });
    let DPR = Math.max(1, window.devicePixelRatio || 1);
    function resizeGrid(){
      DPR = Math.max(1, window.devicePixelRatio || 1);
      gridCanvas.width = Math.floor(window.innerWidth * DPR);
      gridCanvas.height = Math.floor(window.innerHeight * DPR);
      gridCanvas.style.width = window.innerWidth + 'px';
      gridCanvas.style.height = window.innerHeight + 'px';
      gridCtx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener('resize', resizeGrid); resizeGrid();

    // TD-like XY particles field effect
    let frame = 0;
    let gridRes = 50; // XY "resolution" step
    function drawGridField(){
      gridCtx.clearRect(0,0,gridCanvas.width/DPR,gridCanvas.height/DPR);
      // Axis-aligned grid / particles
      for(let y=0;y<gridCanvas.height/DPR;y+=gridRes){
        for(let x=0;x<gridCanvas.width/DPR;x+=gridRes){
          // Abstract "luminance"/XY field value
          const v = 0.5 + 0.43 * Math.sin(x*0.1 + frame*0.02) + 0.33*Math.cos(y*0.07 + frame*0.016);
          const r = 105 + Math.floor(140*v + 32*Math.sin(frame/18+y*0.13));
          gridCtx.fillStyle = `rgb(${r},${r},${r})`;
          gridCtx.globalAlpha = 0.96;
          gridCtx.fillRect(x, y, gridRes-4, gridRes-4);

          // Axis-aligned dot (for TD touch: mesh node in center)
          gridCtx.globalAlpha = 0.13 + 0.88 * v;
          gridCtx.beginPath();
          gridCtx.arc(x+gridRes/2, y+gridRes/2, 11 + 7*Math.abs(Math.sin(x / 13 + frame * 0.03)), 0, Math.PI*2);
          gridCtx.fillStyle = `rgb(${r},${r},${r})`;
          gridCtx.fill();
        }
      }
      gridCtx.globalAlpha = 1.0;
      frame++;
      requestAnimationFrame(drawGridField);
    }
    drawGridField();

    // --- Ticker ---
    const ticker=document.getElementById('ticker');
    function addTicker(txt){
      const line=document.createElement('div');
      line.className='tline';
      line.textContent=txt; ticker.prepend(line);
      if(ticker.children.length>80)ticker.removeChild(ticker.lastChild);
    }
    ['HUD ready','TouchDesigner XY mesh field','Drag windows to test'].forEach((m,i)=>setTimeout(()=>addTicker(m),300*i));
    
    // --- Spawn windows, each streams grid field ---
    const gridStream = gridCanvas.captureStream(30);
    let winCount=0, spawnUsed=false;
    function makeMiniWindow({x=100,y=150}={}){
      if(window.innerWidth < 700 && x > 20) x = 20;
      winCount++;
      const el=document.createElement('div');
      el.className='miniWin';
      el.style.left=x+'px'; el.style.top=y+'px';
      el.innerHTML=`
        <div class="miniBar">
          <div class="miniTitle">canvas_${String(winCount).padStart(4,'0')}</div>
        </div>
        <div class="miniInner"><video class="miniVideo" autoplay muted playsinline></video></div>`;
      document.body.appendChild(el);
      const v=el.querySelector('.miniVideo');
      v.srcObject = gridStream;
      v.play();
      // Drag logic
      const bar=el.querySelector('.miniBar');
      let dragging=false,sx=0,sy=0,sl=0,st=0;
      function start(e){
        dragging=true;
        const r=el.getBoundingClientRect(); sl=r.left; st=r.top;
        sx=(e.touches?e.touches[0].clientX:e.clientX);
        sy=(e.touches?e.touches[0].clientY:e.clientY);
        document.addEventListener('pointermove',move);
        document.addEventListener('pointerup',stop);
        document.addEventListener('touchmove',move,{passive:false});
        document.addEventListener('touchend',stop);
      }
      function move(e){
        if(!dragging)return;
        const cx=(e.touches?e.touches[0].clientX:e.clientX);
        const cy=(e.touches?e.touches[0].clientY:e.clientY);
        el.style.left=(sl+(cx-sx))+'px'; el.style.top=(st+(cy-sy))+'px';
        e.preventDefault?.();
      }
      function stop(){
        dragging=false;
        document.removeEventListener('pointermove',move);
        document.removeEventListener('pointerup',stop);
        document.removeEventListener('touchmove',move);
        document.removeEventListener('touchend',stop);
      }
      bar.addEventListener('pointerdown',start);
      bar.addEventListener('touchstart',start,{passive:false});
      return el;
    }
    const btnSpawn5=document.getElementById('btnSpawn5');
    const btnCloseAll=document.getElementById('btnCloseAll');
    btnSpawn5.addEventListener('click',()=>{
      if(spawnUsed)return addTicker('spawn blocked: already active');
      spawnUsed=true;
      let startX=170+Math.random()*40,startY=300+Math.random()*40;
      if(window.innerWidth < 700) startX=20;
      for(let i=0;i<5;i++) makeMiniWindow({x:startX+i*26,y:startY+i*28});
      addTicker('spawned 5 mesh field windows');
    });
    btnCloseAll.addEventListener('click',()=>{
      document.querySelectorAll('.miniWin').forEach(n=>n.remove());
      winCount=0; spawnUsed=false;
      addTicker('all windows closed');
    });

    // Spawn initial windows
    (()=>{
      let startX = 100, startY = 170;
      if(window.innerWidth < 700) startX = 20;
      for(let i=0;i<5;i++) makeMiniWindow({x:startX+i*22, y:startY+i*16});
    })();
  </script>

  
      <script>
  // Set this to the URL or HTML file you want to go to next
  var nextPage = "https://jeff-gompertz.github.io/CUseeme/videotemplate/test_run_inject_touch3.html"; // Example: "slide2.html", "my-next-design.html", etc.

  // Listen for any click or touch on the document
  document.addEventListener("click", function() {
    window.location.href = nextPage;b
  });

  document.addEventListener("touchend", function() {
    window.location.href = nextPage;
  });
</script>
</body>
</html>
