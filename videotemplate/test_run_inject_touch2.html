<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HUD + Grid Field â€” Mini Windows Only Visual Output</title>
  <style>
    html,body{height:100%;margin:0;background:#141417;color:#fff;font-family:system-ui;}
    #bgVideo{position:fixed;top:0;left:0;width:100vw;height:100vh;object-fit:cover;z-index:-2;}
    #gridCanvas{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-1;}
    .miniWin{
      position:absolute;width:300px;height:220px;background:rgba(210,240,255,0.23);
      border-radius:16px;overflow:hidden;box-shadow:0 6px 30px rgba(0,0,0,0.26);border:2px solid #fff;z-index:500;
    }
    .miniBar{background:rgba(255,255,255,0.18);font-size:13px;padding:6px 15px;}
    .miniInner{width:100%;height:calc(100% - 32px);}
    .miniVideo{width:100%;height:100%;object-fit:cover;background:#111;}
    #hudWrapper{position:fixed;top:16px;left:16px;z-index:100;}
    .hud-row{display:flex;gap:14px;margin-bottom:6px;}
    .hud-btn{padding:8px 16px;background:#ccd;border:none;border-radius:8px;color:#222;font-size:16px;cursor:pointer;}
  </style>
</head>
<body>
  <!-- Background video (optional) -->
  <video id="bgVideo" autoplay muted loop playsinline>
    <source src="/CUseeme/media/VideoObject.mp4" type="video/mp4" />
  </video>
  <!-- Canvas renders the grid field effect -->
  <canvas id="gridCanvas"></canvas>
  <!-- HUD for spawn/close control -->
  <div id="hudWrapper">
    <div class="hud-row">
      <button class="hud-btn" id="btnSpawn5">Spawn 5</button>
      <button class="hud-btn" id="btnCloseAll">Close All</button>
    </div>
  </div>
  <script>
    // --- TouchDesigner-style grid/camera effect (only visual!!) ---
    const canvas = document.getElementById('gridCanvas');
    const ctx = canvas.getContext('2d',{alpha:true});
    let DPR = window.devicePixelRatio||1;
    function resize(){
      DPR = window.devicePixelRatio||1;
      canvas.width = window.innerWidth * DPR;
      canvas.height = window.innerHeight * DPR;
      canvas.style.width = window.innerWidth+"px";
      canvas.style.height = window.innerHeight+"px";
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener('resize',resize);resize();

    // Abstract grid+particles (NO UI panel, only the result)
    let t = 0;
    function draw(){
      ctx.fillStyle="#222";ctx.fillRect(0,0,canvas.width/DPR,canvas.height/DPR);
      for(let y=0;y<canvas.height/DPR;y+=24){
        for(let x=0;x<canvas.width/DPR;x+=24){
          const v = 0.55 + 0.32 * Math.sin(x*0.085+t*0.015) + 0.31*Math.cos(y*0.063+t*0.012);
          const r = 200+Math.floor(63*v+33*Math.sin(t/29+y*0.06));
          ctx.fillStyle=`rgb(${r},${r},${r})`;
          ctx.fillRect(x,y,22,22);
        }
      }
      t+=1;
      requestAnimationFrame(draw);
    }
    draw();

    // The stream from the processed visual only
    const gridStream = canvas.captureStream(30);

    // Mini-windows spawn logic
    let winCount=0,spawnUsed=false;
    function makeMiniWindow({x=100,y=180}={}){
      winCount++;
      const el=document.createElement('div');
      el.className='miniWin';
      el.style.left=x+'px';el.style.top=y+'px';
      el.innerHTML=`
        <div class="miniBar">Visual_${String(winCount).padStart(2,'0')}</div>
        <div class="miniInner"><video class="miniVideo" autoplay muted playsinline></video></div>`;
      document.body.appendChild(el);
      const v=el.querySelector('.miniVideo');
      v.srcObject = gridStream;
      v.play();
      // Drag logic
      const bar = el.querySelector('.miniBar');
      let dragging=false,sx=0,sy=0,sl=0,st=0;
      bar.addEventListener('pointerdown',function(e){
        dragging=true;sl=el.offsetLeft;st=el.offsetTop;sx=e.clientX;sy=e.clientY;
        document.addEventListener('pointermove',move);document.addEventListener('pointerup',stop);
      });
      function move(e){if(!dragging)return;el.style.left=(sl+(e.clientX-sx))+"px";el.style.top=(st+(e.clientY-sy))+"px";}
      function stop(){dragging=false;document.removeEventListener('pointermove',move);document.removeEventListener('pointerup',stop);}
      return el;
    }

    document.getElementById("btnSpawn5").onclick = function(){
      if(spawnUsed)return;
      spawnUsed=true;
      for(let i=0;i<5;i++)makeMiniWindow({x:100+i*34,y:180+i*28});
    };
    document.getElementById("btnCloseAll").onclick = function(){
      document.querySelectorAll('.miniWin').forEach(n=>n.remove());winCount=0;spawnUsed=false;
    };

    // Spawn one at load
    makeMiniWindow();
  </script>
</body>
</html>
