<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CUSeeMe Modular v1.7 ‚Äî HUD Toggle Demo (Mobile Clean)</title>
  <style>
    :root {
      --hud-glass: rgba(255, 225, 255, 0.45);
      --hud-border-light: rgba(255, 255, 255, 0.65);
      --hud-border-dark: rgba(0, 45, 90, 0.35);
      --hud-shadow: 0 12px 45px rgba(0, 50, 90, 0.35);
      --hud-text: #1b1d22;
      --btn-bg: rgba(215, 235, 255, 0.35);
      --btn-inset-light: rgba(255,255,255,0.8);
      --btn-inset-dark: rgba(0,30,60,0.3);
      --btn-glow: rgba(255,120,50,0.7);
      --btn-glow-outer: rgba(255,150,80,0.35);
      --background: transparent;
      --ticker: #ff3a2f;
    }
    html,body{
      height:100%; margin:0;
      background: transparent;
      font-family: "VT323", ui-monospace, Menlo, Consolas, monospace;
      color:#222;
      overflow:visible;
    }
    #bgVideo {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      object-fit: cover;
      z-index: -2;
      pointer-events: none;
    }
    #hudIndex{
      position:absolute;
      top:6px; left:10px;
      font-size:12px;
      opacity:.55;
    }
    .hud-row{ display:flex; gap:12px; justify-content:space-between; }
    .hud-btn{
      flex:1;
      font-family:"VT323", monospace;
      font-size:17px;
      color:#132030;
      background:var(--btn-bg);
      border:none;
      border-radius:10px;
      box-shadow:
        inset 1px 1px 2px var(--btn-inset-light),
        inset -1px -2px 3px var(--btn-inset-dark),
        0 3px 6px rgba(0,0,0,0.08);
      padding:10px 12px;
      cursor:pointer;
      transition:all .22s ease;
    }
    .hud-btn:hover{
      transform:translateY(-1px);
      box-shadow:0 5px 12px rgba(0,0,0,0.15);
    }
    .hud-btn.active{
      background:rgba(255,165,100,0.15);
      color:#ff6a2f;
      font-weight:600;
      box-shadow:
        inset 0 0 4px var(--btn-glow),
        0 0 14px 3px var(--btn-glow-outer),
        0 2px 8px rgba(0,0,0,0.2);
    }
    .hud-panel { position: relative; opacity: 1; pointer-events: auto; transition: opacity .3s ease; }
    .hud-panel:not(.active) { opacity: 0.8; }
    #ticker{
      position:fixed; left:16px; bottom:14px; z-index:900;
      width:45vw; max-width:700px; max-height:50vh;
      display:flex; flex-direction:column-reverse; overflow:hidden;
      color:var(--ticker);
      font-size:18px; line-height:1.25;
    }
    .tline{ opacity:.95; margin:0; animation:fadeIn .6s ease; }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }
    .miniWin{
      position:absolute;
      width:66vw; max-width:380px; aspect-ratio:9/12;
      background:rgba(210,240,255,0.25);
      border:1px solid rgba(255,255,255,0.55);
      border-radius:16px;
      backdrop-filter:blur(12px);
      box-shadow:
        inset 0 1px 2px rgba(255,255,255,0.6),
        0 18px 40px rgba(0,0,0,0.25);
      overflow:hidden;
      cursor:grab;
      z-index:500;
    }
    .miniWin:active{ cursor:grabbing; }
    .miniBar{
      display:flex; align-items:center; justify-content:space-between;
      padding:4px 10px; height:26px;
      background:rgba(255,255,255,0.18);
      font-size:12px; color:#222; user-select:none;
    }
    .miniInner{ position:relative; width:100%; height:calc(100% - 26px); }
    .miniVideo{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit:cover; transform:scaleX(-1);
      background: black;
    }
    @media (max-width: 700px) {
      .miniWin {
        left: 4vw !important;
        right: auto !important;
        max-width: 90vw !important;
        width: 90vw !important;
      }
    }
  </style>
</head>
<body>
  <!-- Fullscreen Video Background -->
  <video id="bgVideo" autoplay muted loop playsinline>
    <source src="/CUseeme/media/VideoObject.mp4" type="video/mp4" />
    Your browser does not support HTML5 video.
  </video>
  <video id="cameraMain" autoplay muted playsinline style="display:none"></video>

  <!-- [L1] HUD WRAPPER -->
  <div id="hudWrapper">
    <div id="hudIndex">1 of 2</div>
    <div id="hudShell">
      <div id="hudHeader">2 of 2</div>
      <div id="hud1" class="hud-panel active">
        <div class="hud-row">
          <button class="hud-btn" id="btnSpawn5">‚ûï Spawn 5</button>
          <button class="hud-btn" id="btnReverseCam">üîÅ Reverse Cam</button>
        </div>
        <div class="hud-row">
          <button class="hud-btn" id="btnCloseAll">‚úï Close All</button>
        </div>
      </div>
    </div>
  </div>
  <div id="ticker"></div>
  <!-- [REMOVED: promptWrap and input box] -->
  <script>
    // === TOGGLE THIS TO SWITCH BEHAVIOR (card windows) ===
    // true = use LIVE CAMERA in card windows
    // false = use playback of background video from below ("VideoObject.mp4") in card windows
    const USE_LIVE_CAMERA = false;
    const BG_VIDEO_FILENAME = "/CUseeme/media/VideoObject.mp4";

    const ticker=document.getElementById('ticker');
    function addTicker(txt){
      const line=document.createElement('div');
      line.className='tline';
      line.textContent=txt;
      ticker.prepend(line);
      if(ticker.children.length>80)ticker.removeChild(ticker.lastChild);
    }
    ['index: v1.7 mode dynamic','retro4.4 aqua loaded','HUD ready','multi-HUD active']
    .forEach((m,i)=>setTimeout(()=>addTicker(m),250*i));

    let mediaStream=null;
    let facing='environment';

    async function initStream(){
      if(!USE_LIVE_CAMERA) return;
      if(mediaStream){ mediaStream.getTracks().forEach(t=>t.stop()); mediaStream=null; }
      try{
        mediaStream=await navigator.mediaDevices.getUserMedia({
          video:{facingMode:{ideal:facing}}, audio:false
        });
        addTicker(`camera: ${facing==='user'?'front':'rear'} feed ready`);
        document.querySelectorAll('.miniVideo').forEach(v=>v.srcObject=mediaStream);
      }catch(e){ addTicker('‚ö† camera denied/unavailable'); }
    }

    // =========================
    // === MINI WINDOW SYSTEM START üü¶üü©üüßüü•üü®üü´‚¨õüü™ ===
    // =========================

    let winCount = 0, spawnUsed = false;

    /** 
     * üü™ makeMiniWindow({x, y}) ‚Äî spawns a draggable "card" at X and Y.
     *   - x: horizontal (how far from the LEFT edge, in pixels)
     *   - y: vertical (how far from TOP, in pixels)
     */
    function makeMiniWindow({x=150, y=300}={}) {
      // üõë BLOCKER WARNING üõë
      // If you uncomment this line, it will "clamp" cards to far left on narrow/mobile screens
      // (window.innerWidth < 700) means "phone/tablet"
      // if(window.innerWidth < 700 && x > 20) x = 20; // << REMOVE OR COMMENT TO ENABLE CUSTOM POSITIONS
      winCount++;
      const el=document.createElement('div');
      el.className='miniWin';
      el.style.left=x+'px';       // üü™ X: How far from LEFT page edge (change 'x' to adjust globally)
      el.style.top=y+'px';        // üü¶ Y: How far from TOP of the page

      el.innerHTML=`
        <div class="miniBar">
          <div class="miniTitle">subject_${String(winCount).padStart(4,'0')}</div>
          <div class="miniBtns"><div class="win-dot"></div><div class="win-dot"></div><div class="win-dot"></div></div>
        </div>
        <div class="miniInner"><video class="miniVideo" autoplay muted loop playsinline></video></div>`;
      document.body.appendChild(el);
      const v=el.querySelector('.miniVideo');

      if (USE_LIVE_CAMERA) {
        if(mediaStream) v.srcObject = mediaStream;
      } else {
        v.src = BG_VIDEO_FILENAME;
        v.loop = true;
        v.muted = true;
        v.autoplay = true;
        v.playsInline = true;
        v.currentTime = document.getElementById('bgVideo').currentTime;
      }

      // üü´ DRAG LOGIC üü´
      const bar=el.querySelector('.miniBar');
      let dragging=false,sx=0,sy=0,sl=0,st=0;
      function start(e){
        dragging=true;
        const r=el.getBoundingClientRect(); sl=r.left; st=r.top;
        sx=(e.touches?e.touches[0].clientX:e.clientX);
        sy=(e.touches?e.touches[0].clientY:e.clientY);
        document.addEventListener('pointermove',move);
        document.addEventListener('pointerup',stop);
        document.addEventListener('touchmove',move,{passive:false});
        document.addEventListener('touchend',stop);
      }
      function move(e){
        if(!dragging)return;
        const cx=(e.touches?e.touches[0].clientX:e.clientX);
        const cy=(e.touches?e.touches[0].clientY:e.clientY);
        el.style.left=(sl+(cx-sx))+'px';
        el.style.top=(st+(cy-sy))+'px';
        e.preventDefault?.();
      }
      function stop(){
        dragging=false;
        document.removeEventListener('pointermove',move);
        document.removeEventListener('pointerup',stop);
        document.removeEventListener('touchmove',move);
        document.removeEventListener('touchend',stop);
      }
      bar.addEventListener('pointerdown',start);
      bar.addEventListener('touchstart',start,{passive:false});
      return el;
    }

    // === SPAWN BUTTONS: Control WHERE cards appear, how they're spaced & mobile override ===
    const btnSpawn5=document.getElementById('btnSpawn5');
    const btnCloseAll=document.getElementById('btnCloseAll');
    btnSpawn5.addEventListener('click',()=>{
      if(spawnUsed)return addTicker('spawn blocked: already active');
      spawnUsed=true;
      let startX=170+Math.random()*40, startY=300+Math.random()*40;
      if(window.innerWidth < 700) startX = 40; // ‚Üê change 40 to 80 or higher for mobile margin!
      for(let i=0;i<5;i++) makeMiniWindow({x:startX+i*26, y:startY+i*18});
      addTicker('spawned 5 windows');
    });

    btnCloseAll.addEventListener('click',()=>{
      document.querySelectorAll('.miniWin').forEach(n=>n.remove());
      winCount=0; spawnUsed=false;
      addTicker('all windows closed');
    });

    // üü´ INITIAL AUTO-SPAWN ‚Äî When page loads, cards spawn automatically at these positions
    (async()=>{
      await initStream();
      let startX = 100, startY = 170;
      if(window.innerWidth < 700) startX = 40; // ‚Üê change 40 to 80 or higher for mobile margin!
      for(let i=0;i<5;i++) makeMiniWindow({x:startX+i*22, y:startY+i*18});
    })();

    // =========================
    // === MINI WINDOW SYSTEM END üü¶üü©üüßüü•üü®üü´‚¨õüü™ ===
    // =========================

    // --- HUD / CAMERA PANEL LOGIC ---
    document.getElementById('btnReverseCam').addEventListener('click',async()=>{
      facing=(facing==='user')?'environment':'user';
      await initStream();
    });

    // --- HUD PANEL SWITCHING ---
    const huds = [...document.querySelectorAll('.hud-panel')];
    const hudIndex = document.getElementById('hudIndex');
    let currentHUD = 0;
    function updateHUDLabel(){
      hudIndex.textContent = `HUD ${currentHUD + 1} / ${huds.length}`;
    }
    function showHUD(i){
      huds[currentHUD].classList.remove('active');
      currentHUD = (i + huds.length) % huds.length;
      huds[currentHUD].classList.add('active');
      updateHUDLabel();
      addTicker(`HUD switched ‚Üí ${currentHUD + 1}`);
    }
    document.getElementById('hudHeader').addEventListener('click',()=>showHUD(currentHUD + 1));
    updateHUDLabel();
  </script>
</body>
</html>
