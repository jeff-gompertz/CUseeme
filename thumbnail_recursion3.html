<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Thumbnail Recursion 4</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
  }

  canvas {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
  }

  .floating-window {
    position: absolute;
    width: 280px;
    height: 180px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.15); /* more translucent */
    backdrop-filter: blur(10px);           /* frosted glass effect */
    border-radius: 8px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.4);
    cursor: grab;
    user-select: none;
    overflow: hidden;
    z-index: 1;
  }

  .floating-window img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none;
  }

  .floating-window:active { cursor: grabbing; }
</style>
</head>
<body>
<canvas id="feedback"></canvas>
<div id="windows"></div>

<script>
const container = document.getElementById("windows");
const canvas = document.getElementById("feedback");
const ctx = canvas.getContext("2d");
let W = window.innerWidth, H = window.innerHeight;
canvas.width = W; canvas.height = H;

window.addEventListener("resize", () => {
  W = window.innerWidth; H = window.innerHeight;
  canvas.width = W; canvas.height = H;
});

/* RSS feed */
const feedUrl = "https://www.youtube.com/feeds/videos.xml?channel_id=UCREEmHdAYvlboosrKCHe4UA";
let windows = [];

fetch("https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(feedUrl))
  .then(r => r.json())
  .then(data => {
    const items = (data.items || []).slice(0, 15);
    const picks = items.sort(() => 0.5 - Math.random()).slice(0, 6);

    picks.forEach((item, i) => {
      const vid = (item.guid || "").split(":").pop();
      const src = item.thumbnail || `https://i.ytimg.com/vi/${vid}/hqdefault.jpg`;

      const div = document.createElement("div");
      div.className = "floating-window";
      div.style.left = (Math.random() * (W-300)) + "px";
      div.style.top  = (Math.random() * (H-200)) + "px";

      const img = new Image();
      img.crossOrigin = "anonymous";
      img.src = src;
      div.appendChild(img);

      container.appendChild(div);
      makeDrift(div, img);
    });
  });

function makeDrift(el, img) {
  let vx = (Math.random() * 2 - 1) * 1.0;
  let vy = (Math.random() * 2 - 1) * 1.0;
  let dragging = false, offX = 0, offY = 0;

  el.addEventListener("pointerdown", e => {
    dragging = true;
    offX = e.clientX - el.offsetLeft;
    offY = e.clientY - el.offsetTop;
    el.style.cursor = "grabbing";
    el.setPointerCapture(e.pointerId);
  });

  el.addEventListener("pointermove", e => {
    if (!dragging) return;
    let x = e.clientX - offX;
    let y = e.clientY - offY;
    x = Math.max(0, Math.min(W - el.offsetWidth, x));
    y = Math.max(0, Math.min(H - el.offsetHeight, y));
    el.style.left = x + "px";
    el.style.top  = y + "px";
  });

  el.addEventListener("pointerup", e => {
    dragging = false;
    el.style.cursor = "grab";
    try { el.releasePointerCapture(e.pointerId); } catch {}
  });

  function animate() {
    if (!dragging) {
      let x = el.offsetLeft + vx;
      let y = el.offsetTop  + vy;

      if (x <= 0 || x + el.offsetWidth >= W) vx *= -1;
      if (y <= 0 || y + el.offsetHeight >= H) vy *= -1;

      el.style.left = Math.max(0, Math.min(W - el.offsetWidth, x)) + "px";
      el.style.top  = Math.max(0, Math.min(H - el.offsetHeight, y)) + "px";
    }

    // paint trails
    ctx.globalAlpha = 0.85; // fade factor
    ctx.fillStyle = "rgba(0,0,0,0.25)";
    ctx.fillRect(0,0,W,H);

    ctx.globalAlpha = 0.9;
    ctx.drawImage(img, el.offsetLeft, el.offsetTop, el.offsetWidth, el.offsetHeight);

    requestAnimationFrame(animate);
  }
  animate();
}
</script>
</body>
</html>
