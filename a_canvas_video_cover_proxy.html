<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Canvas Video Cover via Netlify Proxy</title>
<style>
  html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    overflow: hidden;
    background: black;
  }
  canvas {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    display: block;
  }
  #status {
    position: absolute;
    top: 10px; left: 10px;
    color: white;
    font-family: monospace;
    font-size: 14px;
    text-shadow: 0 0 4px black;
    z-index: 10;
  }
</style>
</head>
<body>
<div id="status">🔄 Loading video via Netlify proxy...</div>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const video = document.createElement("video");
const status = document.getElementById("status");

// 👇 replace with your own Netlify domain if needed
const proxyURL = "https://meek-blancmange-803ac1.netlify.app/.netlify/functions/proxy?url=" +
  encodeURIComponent("https://player.vimeo.com/external/76979871.sd.mp4?s=aaefb07e1dcff44df2dfd3c9ee50ff9a0d0e6e2a&profile_id=164");

video.crossOrigin = "anonymous";
video.src = proxyURL;
video.muted = true;
video.loop = true;
video.playsInline = true;
video.autoplay = true;
video.style.display = "none";
document.body.appendChild(video);

let vw = window.innerWidth;
let vh = window.innerHeight;
canvas.width = vw;
canvas.height = vh;

// 🧠 Cover-scaling draw loop
function draw() {
  if (video.readyState >= 2) {
    const vidW = video.videoWidth;
    const vidH = video.videoHeight;
    const scale = Math.max(vw / vidW, vh / vidH);
    const sw = vidW * scale;
    const sh = vidH * scale;
    const x = (vw - sw) / 2;
    const y = (vh - sh) / 2;
    ctx.drawImage(video, x, y, sw, sh);
  }
  requestAnimationFrame(draw);
}

video.addEventListener("play", () => {
  status.textContent = "✅ Proxy video playing";
  draw();
});

video.addEventListener("error", e => {
  console.error("Video error:", e);
  status.textContent = "⚠️ Video load failed (check proxy)";
});

video.play().catch(err => {
  status.textContent = "🖐 Tap to start (autoplay blocked)";
  console.warn("Autoplay blocked:", err);
  document.body.addEventListener("click", () => {
    video.play();
  }, { once: true });
});

window.addEventListener("resize", () => {
  vw = window.innerWidth;
  vh = window.innerHeight;
  canvas.width = vw;
  canvas.height = vh;
});
</script>
</body>
</html>
