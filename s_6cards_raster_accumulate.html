<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>6Cards â€” Transparent Accumulation Sweep</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#111;}
  canvas{display:block;width:100%;height:100%;}
</style>
</head>
<body>
<canvas id="c"></canvas>

<script>
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d",{alpha:true});

let W=innerWidth,H=innerHeight;
function resize(){W=innerWidth;H=innerHeight;canvas.width=W;canvas.height=H;}
addEventListener("resize",resize);resize();

/* === YouTube RSS thumbnails === */
const FEED_URL="https://www.youtube.com/feeds/videos.xml?channel_id=UCREEmHdAYvlboosrKCHe4UA";
const RSS_API="https://api.rss2json.com/v1/api.json?rss_url="+encodeURIComponent(FEED_URL);

async function loadThumbs(){
  try{
    const r=await fetch(RSS_API);
    const d=await r.json();
    const items=(d.items||[]).slice(0,6);
    const imgs=[];
    for(const it of items){
      const vid=(it.guid||"").split(":").pop();
      const src=it.thumbnail||`https://i.ytimg.com/vi/${vid}/hqdefault.jpg`;
      const im=new Image();im.crossOrigin="anonymous";
      await new Promise(res=>{im.onload=res;im.onerror=res;im.src=src;});
      if(im.width)imgs.push(im);
    }
    return imgs;
  }catch(e){console.warn("feed error",e);return[];}
}

/* === Card setup === */
const cards=[];
const rows=6;
let scanSpeed=2.5;
function makeCards(imgs){
  for(let i=0;i<rows;i++){
    const w=200,h=H/rows*0.8;
    cards.push({w,h,img:imgs[i%imgs.length],x:-w,y:(i*H/rows)+(H/rows-h)/2});
  }
}

/* helper */
function drawImageCover(img,x,y,w,h){
  const iw=img.naturalWidth||img.width,ih=img.naturalHeight||img.height;
  if(!iw||!ih)return;
  const r=Math.max(w/iw,h/ih);
  const nw=iw*r,nh=ih*r;
  const ox=x+(w-nw)/2,oy=y+(h-nh)/2;
  ctx.drawImage(img,ox,oy,nw,nh);
}

/* === Animation === */
let activeRow=0;
function animate(){
  // translucent black fade (not erasure)
  ctx.globalCompositeOperation="source-over";
  ctx.globalAlpha=0.02;             // smaller = longer memory
  ctx.fillStyle="rgba(0,0,0,1)";
  ctx.fillRect(0,0,W,H);

  // additive pass
  ctx.globalCompositeOperation="lighter";
  ctx.globalAlpha=0.2;              // controls brightness

  cards.forEach((c,i)=>{
    if(!c.img)return;
    if(i===activeRow){
      c.x+=scanSpeed;
      if(c.x>W){
        c.x=-c.w;
        activeRow=(activeRow+1)%rows;
      }
    }
    drawImageCover(c.img,c.x,c.y,c.w,c.h);
  });

  requestAnimationFrame(animate);
}

/* === Boot === */
(async function(){
  const imgs=await loadThumbs();
  if(!imgs.length){
    const dummy=new Image();
    dummy.src="https://i.ytimg.com/vi/dQw4w9WgXcQ/hqdefault.jpg";
    await new Promise(r=>{dummy.onload=r;});
    makeCards([dummy]);
  }else makeCards(imgs);
  animate();
})();
</script>
</body>
</html>
