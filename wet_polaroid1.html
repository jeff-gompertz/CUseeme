<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>thumbnail_recursion5_1 — full-bleed tuned</title>
<style>
  html,body{
    margin:0;
    height:100%;
    overflow:hidden;
    background:#000;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  }
  canvas{
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    display:block;
    z-index:0;
  }
  .hud{
    position:fixed;
    left:10px;bottom:10px;
    color:#cfe7ff;
    font-size:13px;
    line-height:1.45;
    background:rgba(0,0,0,0.45);
    padding:8px 10px;
    border-radius:6px;
    opacity:.85;
    user-select:none;
    z-index:2;
    mix-blend-mode:screen;
    white-space:pre;
  }
  .hud b{color:#fff;font-weight:600;}
  .hud .key{
    padding:1px 4px;
    border:1px solid #6a7;
    border-radius:4px;
    margin:0 2px;
    color:#cfe;
  }
</style>
</head>
<body>
<canvas id="fx"></canvas>
<div class="hud" id="hud"></div>

<script>
(function(){
  const FEED_URL="https://www.youtube.com/feeds/videos.xml?channel_id=UCREEmHdAYvlboosrKCHe4UA";
  const RSS_API="https://api.rss2json.com/v1/api.json?rss_url=";
  const MAX_ITEMS=12,SWAP_EVERY_MS=7000;

  let MODE={
    additive:true,
    recursiveZoom:true,
    wobble:true,
    fadeToBlack:true,
    pause:false
  };
  let PARAM={
    fadeAlpha:0.12,   // slower fade → longer trails
    imgAlpha:0.22,    // dimmer stamp → prevents whiteout
    zoomPush:1.004,
    zoomJitter:1.5,
    wobbleAx:0.015,
    wobbleAy:0.010,
    wobbleSpeed:0.5
  };

  const canvas=document.getElementById("fx");
  const ctx=canvas.getContext("2d",{alpha:true});
  let DPR=Math.max(1,Math.min(2,window.devicePixelRatio||1));
  function resize(){
    const w=window.innerWidth,h=window.innerHeight;
    canvas.width=Math.floor(w*DPR);
    canvas.height=Math.floor(h*DPR);
    canvas.style.width=w+"px";
    canvas.style.height=h+"px";
    ctx.setTransform(DPR,0,0,DPR,0,0);
    ctx.globalAlpha=1;
    ctx.fillStyle="#000";
    ctx.fillRect(0,0,w,h);
  }
  window.addEventListener("resize",resize);
  resize();

  function drawImageCover(img,dx,dy,dw,dh){
    const iw=img.naturalWidth||img.width,ih=img.naturalHeight||img.height;
    if(!iw||!ih)return;
    const r=Math.max(dw/iw,dh/ih);
    const nw=iw*r,nh=ih*r;
    const ox=dx+(dw-nw)/2,oy=dy+(dh-nh)/2;
    ctx.drawImage(img,ox,oy,nw,nh);
  }

  let images=[],currentIndex=0,lastSwap=performance.now();

  function loadFeed(){
    return fetch(RSS_API+encodeURIComponent(FEED_URL))
      .then(r=>r.json())
      .then(d=>{
        const items=(d.items||[]).slice(0,MAX_ITEMS);
        return Promise.all(items.map(v=>{
          const vid=((v.guid||"").split(":").pop())||"";
          const t=v.thumbnail||`https://i.ytimg.com/vi/${vid}/hqdefault.jpg`;
          return new Promise(res=>{
            const im=new Image();
            im.crossOrigin="anonymous";
            im.onload=()=>res(im);
            im.onerror=()=>res(null);
            im.src=t;
          });
        }));
      })
      .then(arr=>{images=arr.filter(Boolean);});
  }
  const FALLBACK=[
    'https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1600&auto=format&fit=crop',
    'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop',
    'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=1600&auto=format&fit=crop'
  ];
  function loadFallback(){
    return Promise.all(FALLBACK.map(s=>new Promise(r=>{
      const im=new Image();
      im.crossOrigin="anonymous";
      im.onload=()=>r(im);im.onerror=()=>r(null);im.src=s;
    }))).then(a=>{images=a.filter(Boolean);});
  }

  let t0=performance.now();
  function loop(now){
    const W=canvas.width/DPR,H=canvas.height/DPR;
    const time=(now-t0)*0.001;
    if(!MODE.pause){
      if(MODE.fadeToBlack){
        ctx.globalCompositeOperation="source-over";
        ctx.globalAlpha=PARAM.fadeAlpha;
        ctx.fillStyle="#000";
        ctx.fillRect(0,0,W,H);
      }
      if(MODE.recursiveZoom){
        ctx.globalCompositeOperation=MODE.additive?"lighter":"source-over";
        ctx.globalAlpha=0.90;
        const zx=PARAM.zoomPush;
        const padX=(W*zx-W)*0.5,padY=(H*zx-H)*0.5;
        const jx=(Math.random()*2-1)*PARAM.zoomJitter;
        const jy=(Math.random()*2-1)*PARAM.zoomJitter;
        ctx.drawImage(canvas,-padX+jx,-padY+jy,W*zx,H*zx);
      }
      const img=images.length?images[currentIndex]:null;
      if(img){
        ctx.save();
        if(MODE.wobble){
          const ax=PARAM.wobbleAx*Math.sin(time*PARAM.wobbleSpeed*1.1);
          const ay=PARAM.wobbleAy*Math.cos(time*PARAM.wobbleSpeed*0.9);
          ctx.setTransform(1,ax,ay,1,0,0);
        }else ctx.setTransform(1,0,0,1,0,0);
        ctx.globalCompositeOperation=MODE.additive?"lighter":"source-over";
        ctx.globalAlpha=PARAM.imgAlpha;
        drawImageCover(img,0,0,W,H);
        ctx.restore();
      }
      if(now-lastSwap>SWAP_EVERY_MS&&images.length>1){
        currentIndex=(currentIndex+1)%images.length;
        lastSwap=now;
      }
    }
    if(!loop._hudTick||now-loop._hudTick>100){updateHUD();loop._hudTick=now;}
    requestAnimationFrame(loop);
  }

  const hud=document.getElementById("hud");
  function updateHUD(){
    const lines=[
      `YT thumbnails: ${images.length||'…loading'}`,
      `mode: ${MODE.additive?'additive':'normal'} • zoom:${MODE.recursiveZoom?'on':'off'} • wobble:${MODE.wobble?'on':'off'} • fade:${MODE.fadeToBlack?'on':'off'} • ${MODE.pause?'PAUSED':''}`,
      `fade=${PARAM.fadeAlpha.toFixed(2)} imgα=${PARAM.imgAlpha.toFixed(2)} zoom=${PARAM.zoomPush.toFixed(3)} jitter=${PARAM.zoomJitter.toFixed(1)}`
    ];
    hud.innerHTML=lines.join("\n");
  }

  window.addEventListener("keydown",e=>{
    switch(e.key){
      case 'b':case'B':MODE.additive=!MODE.additive;break;
      case 'z':case'Z':MODE.recursiveZoom=!MODE.recursiveZoom;break;
      case 'w':case'W':MODE.wobble=!MODE.wobble;break;
      case 'f':case'F':MODE.fadeToBlack=!MODE.fadeToBlack;break;
      case 'p':case'P':MODE.pause=!MODE.pause;break;
      default:return;
    }
    e.preventDefault();updateHUD();
  });

  loadFeed().catch(()=>loadFallback()).finally(()=>{
    updateHUD();requestAnimationFrame(loop);
  });
})();
</script>
</body>
</html>
