<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Database Recursion — Text Input Stage 1 (Fixed)</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
    height: 100%;
    font-family: "Helvetica Neue", Arial, sans-serif;
  }

  /* === VISUAL FIELD === */
  canvas {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
  }

  /* === TEXT FEED LAYER === */
  #text-feed {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: flex-end;
    overflow: hidden;
    z-index: -1;
    color: white;
  }

  #feed-content {
    text-align: center;
    width: 80%;
    font-size: 1.5rem;
    line-height: 2rem;
  }

  .headline {
    margin: 1rem 0;
  }
</style>
</head>
<body>

<canvas id="trail"></canvas>
<div id="text-feed"><div id="feed-content"></div></div>

<script>
/* ==========================================================
   VISUAL RECURSION  – visible pulse test
========================================================== */
const canvas = document.getElementById("trail");
const ctx = canvas.getContext("2d");
let W = innerWidth, H = innerHeight;
canvas.width = W; canvas.height = H;
window.addEventListener("resize", () => {
  W = innerWidth; H = innerHeight;
  canvas.width = W; canvas.height = H;
});

let t = 0;
function draw() {
  t += 0.01;
  // fade previous frame
  ctx.fillStyle = "rgba(0,0,0,0.1)";
  ctx.fillRect(0, 0, W, H);

  // vivid central pulse (proof of motion)
  const hue = 180 + 180 * Math.sin(t * 0.5);
  const radius = 60 + 40 * Math.sin(t * 3);
  ctx.beginPath();
  ctx.arc(W/2, H/2, radius, 0, Math.PI * 2);
  ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
  ctx.fill();

  requestAnimationFrame(draw);
}
draw();

/* ==========================================================
   BBC RSS TEXT FEED  – clean film-title scroll
========================================================== */
const feedURL = "https://feeds.bbci.co.uk/news/rss.xml";
const proxy = "https://api.allorigins.win/get?url=" + encodeURIComponent(feedURL);

fetch(proxy)
  .then(r => r.ok ? r.json() : Promise.reject(r))
  .then(data => {
    const parser = new DOMParser();
    const xml = parser.parseFromString(data.contents, "text/xml");
    const titles = [...xml.querySelectorAll("item > title")].map(t => t.textContent);
    buildFeed(titles);
  })
  .catch(err => {
    console.warn("Feed unavailable, using fallback", err);
    buildFeed([
      "Fallback headline — data stream offline",
      "BBC feed not reachable — autonomous mode",
      "Text input layer waiting for new signals"
    ]);
  });

function buildFeed(lines) {
  const feed = document.getElementById("feed-content");
  feed.innerHTML = ""; // clear any old content
  lines.forEach(line => {
    const div = document.createElement("div");
    div.className = "headline";
    div.textContent = line;
    feed.appendChild(div);
  });
  startScroll();
}

/* === Scroll animation === */
function startScroll() {
  const content = document.getElementById("feed-content");
  let y = window.innerHeight * 0.9; // start just below bottom
  content.style.transform = `translateY(${y}px)`;
  content.style.color = "white";
  content.style.opacity = 1.0;

  function animate() {
    y -= 1; // speed in px/frame
    content.style.transform = `translateY(${y}px)`;
    if (y + content.offsetHeight > 0) {
      requestAnimationFrame(animate);
    } else {
      y = window.innerHeight * 0.9; // reset to bottom
      requestAnimationFrame(animate);
    }
  }
  animate();
}
</script>

</body>
</html>
