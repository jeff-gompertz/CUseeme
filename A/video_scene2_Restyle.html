<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CUSeeMe ‚Äî Scene 2 (Clean Final)</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v6.0.0-beta1/css/all.css">

<style>
html,body{
  margin:0; height:100%;
  background:#e5e9f4;
  font-family:system-ui,sans-serif;
  overflow:hidden;
}

/* =========================================================
Header ‚Äî shared Neumorphic design
========================================================= */
header{
  position:fixed; top:0; left:0; width:100%;
  background:#e5e9f4;
  box-shadow:0 5px 10px rgba(0,0,0,0.05);
  z-index:3000;
  display:flex; justify-content:center;
  padding:1rem 0;
}
.buttons{
  display:grid;
  grid-template-columns:repeat(6,minmax(60px,1fr));
  gap:1rem;
  width:min(90vw,500px);
}
button.neumorphic{
  border:0.5rem solid transparent;
  border-radius:1rem;
  color:hsl(0 0% 10%);
  background:none;
  display:grid; place-content:center; gap:.5rem;
  --shadow:-.5rem -.5rem 1rem hsl(0 0% 100%/.75),
           .5rem .5rem 1rem hsl(0 0% 50%/.5);
  box-shadow:var(--shadow);
  transition:.1s;
}
button.neumorphic:hover{color:hsl(10 80% 50%);scale:1.05;}
button.neumorphic:active,
button.neumorphic.active{
  box-shadow:var(--shadow),
              inset .5rem .5rem 1rem hsl(0 0% 50%/.5),
              inset -.5rem -.5rem 1rem hsl(0 0% 100%/.75);
  color:hsl(10 80% 50%);
}
button.neumorphic>i{font-size:20px;}
button.neumorphic>span{font-size:12px;}
@media(max-width:600px){
  .buttons{grid-template-columns:repeat(auto-fit,minmax(50px,1fr));width:95vw;gap:.5rem;}
  button.neumorphic>i{font-size:16px;}
  button.neumorphic>span{font-size:10px;}
}

/* =========================================================
Camera + HUD + Mini windows
========================================================= */
#cameraMain{
  position:fixed; inset:0;
  width:100%; height:100%;
  object-fit:cover;
  transform:scaleX(-1);
  z-index:100;
}

#hudShell{
  position:fixed; top:140px; right:32px;
  z-index:800;
  display:grid; gap:14px;
  padding:28px 26px 26px;
  min-width:320px;
  background:rgba(185,225,255,.45);
  border-radius:20px;
  border:1px solid rgba(255,255,255,.65);
  box-shadow:inset 0 1px 3px rgba(255,255,255,.65),
             inset 0 -1px 3px rgba(0,45,90,.35),
             0 12px 45px rgba(0,50,90,.35);
  backdrop-filter:blur(20px) saturate(1.25);
  -webkit-backdrop-filter:blur(20px) saturate(1.25);
  text-align:center;
}
#hudHeader{font-weight:600; margin-bottom:6px;}
.hud-row{display:flex;gap:12px;justify-content:space-between;}
.hud-btn{
  flex:1;
  font-family:"VT323",monospace;
  font-size:17px;
  background:rgba(215,235,255,.35);
  border:none;border-radius:10px;
  box-shadow:inset 1px 1px 2px rgba(255,255,255,.8),
             inset -1px -2px 3px rgba(0,30,60,.3),
             0 3px 6px rgba(0,0,0,.08);
  padding:10px 12px;cursor:pointer;
  transition:.2s;
}
.hud-btn:hover{transform:translateY(-1px);}
.hud-btn.active{background:rgba(255,165,100,.15);color:#ff6a2f;}

.miniWin{
  position:absolute;
  width:22vw;max-width:380px;aspect-ratio:9/16;
  background:rgba(210,240,255,.25);
  border:1px solid rgba(255,255,255,.55);
  border-radius:16px;
  backdrop-filter:blur(12px);
  box-shadow:inset 0 1px 2px rgba(255,255,255,.6),
             0 18px 40px rgba(0,0,0,.25);
  overflow:hidden;cursor:grab;
  z-index:2000;
}
.miniBar{display:flex;justify-content:space-between;padding:4px 10px;height:26px;
  background:rgba(255,255,255,.18);font-size:12px;}
.miniInner{position:relative;width:100%;height:calc(100% - 26px);}
.miniVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transform:scaleX(-1);}

#ticker{position:fixed;left:16px;bottom:14px;z-index:900;
  width:45vw;max-width:700px;display:flex;flex-direction:column-reverse;
  color:#ff3a2f;font-size:18px;line-height:1.25;}
.tline{animation:fadeIn .6s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
</style>
</head>

<body>

<!-- HEADER -->
<header>
  <div class="buttons">
    <button class="neumorphic"><i class="fa-light fa-fire"></i><span>Spawn 5</span></button>
    <button class="neumorphic"><i class="fa-light fa-dna"></i><span>Reverse Cam</span></button>
    <button class="neumorphic"><i class="fa-light fa-chart-mixed"></i><span>Voice</span></button>
    <button class="neumorphic"><i class="fa-light fa-atom"></i><span>Close All</span></button>
    <button class="neumorphic"><i class="fa-light fa-seedling"></i><span>HUD Shift</span></button>
    <button class="neumorphic active"><i class="fa-light fa-arrow-left"></i><span>Return</span></button>
  </div>
</header>

<!-- MAIN CAMERA + HUD -->
<video id="cameraMain" autoplay muted playsinline></video>

<div id="hudShell">
  <div id="hudHeader">Mode &gt; Shift</div>
  <div class="hud-row">
    <button class="hud-btn" id="btnSpawn5">‚ûï Spawn 5</button>
    <button class="hud-btn" id="btnReverseCam">üîÅ Reverse Cam</button>
  </div>
  <div class="hud-row">
    <button class="hud-btn" id="btnVoice">üîä Voice</button>
    <button class="hud-btn" id="btnCloseAll">‚úï Close All</button>
  </div>
</div>

<div id="ticker"></div>

<script>
/* =========================================================
Camera + HUD Logic
========================================================= */
let mediaStream=null; let facing='environment';
const ticker=document.getElementById('ticker');
function addTicker(t){const l=document.createElement('div');l.className='tline';l.textContent=t;ticker.prepend(l);}
async function initStream(){
  if(mediaStream){mediaStream.getTracks().forEach(tr=>tr.stop());}
  try{
    mediaStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:facing}},audio:false});
    addTicker(`camera: ${facing==='user'?'front':'rear'} feed ready`);
  }catch(e){addTicker('‚ö† camera denied/unavailable');}
}
initStream();

/* =========================================================
Mini-window System
========================================================= */
let winCount=0,spawnUsed=false;
function makeMiniWindow({x=80,y=80}={}){
  winCount++;
  const el=document.createElement('div');
  el.className='miniWin';
  el.style.left=x+'px'; el.style.top=y+'px';
  el.innerHTML=`
    <div class="miniBar"><div>subject_${String(winCount).padStart(4,'0')}</div></div>
    <div class="miniInner"><video class="miniVideo" autoplay muted playsinline></video></div>`;
  document.body.appendChild(el);
  const v=el.querySelector('.miniVideo'); if(mediaStream) v.srcObject=mediaStream;

  const bar=el.querySelector('.miniBar'); let drag=false,sx=0,sy=0,sl=0,st=0;
  function start(e){drag=true;const r=el.getBoundingClientRect();sl=r.left;st=r.top;
    sx=(e.touches?e.touches[0].clientX:e.clientX);
    sy=(e.touches?e.touches[0].clientY:e.clientY);
    document.addEventListener('pointermove',move);
    document.addEventListener('pointerup',stop);}
  function move(e){if(!drag)return;
    const cx=(e.touches?e.touches[0].clientX:e.clientX),
          cy=(e.touches?e.touches[0].clientY:e.clientY);
    el.style.left=(sl+(cx-sx))+'px'; el.style.top=(st+(cy-sy))+'px'; e.preventDefault?.();}
  function stop(){drag=false;
    document.removeEventListener('pointermove',move);
    document.removeEventListener('pointerup',stop);}
  bar.addEventListener('pointerdown',start);
  return el;
}

/* =========================================================
Button Wiring (header + HUD)
========================================================= */
document.addEventListener('DOMContentLoaded',()=>{
  const btnSpawn=document.querySelector('.buttons button:nth-child(1)');
  const btnReverse=document.querySelector('.buttons button:nth-child(2)');
  const btnVoice=document.querySelector('.buttons button:nth-child(3)');
  const btnClose=document.querySelector('.buttons button:nth-child(4)');
  const btnReturn=document.querySelector('.buttons button:nth-child(6)');

  btnSpawn.addEventListener('click',()=>{
    if(spawnUsed)return addTicker('spawn blocked');
    spawnUsed=true;
    for(let i=0;i<5;i++)makeMiniWindow({x:80+i*26,y:120+i*18});
    addTicker('spawned 5 windows');
  });

  btnClose.addEventListener('click',()=>{
    document.querySelectorAll('.miniWin').forEach(n=>n.remove());
    winCount=0;spawnUsed=false;addTicker('all windows closed');
  });

  btnReverse.addEventListener('click',async()=>{
    facing=(facing==='user')?'environment':'user';
    await initStream();addTicker(`camera flipped ‚Üí ${facing}`);
  });

  btnVoice.addEventListener('click',()=>{
    btnVoice.classList.toggle('active');
    addTicker(`voice ${btnVoice.classList.contains('active')?'enabled':'disabled'}`);
  });

  btnReturn.addEventListener('click',()=>{
    window.location.href='https://jeff-gompertz.github.io/CUseeme/A/video_scene1_live_portrait2.html';
  });
});
</script>

<div style="position:fixed;bottom:6px;right:10px;font-family:monospace;font-size:12px;opacity:.6;">Scene 2</div>
</body>
</html>
