<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CUSeeMe Modular v1.8 ‚Äî Compact Lumen</title>

<style>
/* =========================================================
[GLOBAL BASE ‚Äî Compact Lumen Atmosphere]
========================================================= */
html,body{
  margin:0;height:100%;overflow:hidden;
  background:linear-gradient(180deg,#ffffff 0%,#f6f7f9 100%);
  filter:brightness(1.02);
  font-family:"VT323",ui-monospace,Menlo,Consolas,monospace;
  color:#111;
}
/* soft atmospheric veil */
body::before{
  content:"";
  position:fixed;inset:0;
  background:rgba(255,255,255,0.08);
  pointer-events:none;z-index:0;
}

/* =========================================================
[LAYERS]
========================================================= */
#cameraMain{
  position:fixed;inset:0;
  object-fit:cover;
  transform:scaleX(-1);
  z-index:-1;
}

/* =========================================================
[HUD ‚Äî Compact Lumen White Glass]
========================================================= */
#hudShell{
  position:fixed;
  top:16px;right:16px;
  z-index:1000;
  display:grid;gap:10px;
  padding:18px 16px;
  min-width:260px;
  background:rgba(255,255,255,0.35);
  border-radius:16px;
  border:1px solid rgba(255,255,255,0.65);
  box-shadow:
    inset 0 1px 2px rgba(255,255,255,0.6),
    0 12px 40px rgba(0,0,0,0.25);
  backdrop-filter:blur(8px) saturate(1.15);
  -webkit-backdrop-filter:blur(8px) saturate(1.15);
  text-align:center;
  transition:all .25s ease;
}
#hudHeader{
  display:block;margin-bottom:10px;
  font-size:1.3em;
  color:#222;cursor:pointer;
  user-select:none;
}
#hudHeader:hover{
  color:#ff6a2f;
  text-shadow:0 0 6px rgba(255,120,50,.6);
}
#hudIndex{
  position:absolute;top:4px;left:10px;
  font-size:.8em;opacity:.5;
}

/* Buttons */
.hud-row{display:flex;gap:10px;justify-content:space-between;}
.hud-btn{
  flex:1;
  font-family:"VT323",monospace;
  font-size:16px;
  color:#132030;
  background:rgba(255,255,255,0.25);
  border:none;border-radius:10px;
  box-shadow:
    inset 1px 1px 2px rgba(255,255,255,0.8),
    inset -1px -2px 3px rgba(0,0,0,0.1),
    0 3px 6px rgba(0,0,0,0.1);
  padding:9px 10px;
  transition:all .22s ease;
  cursor:pointer;
}
.hud-btn:hover{
  transform:translateY(-1px);
  box-shadow:
    inset 1px 1px 2px rgba(255,255,255,0.8),
    inset -1px -2px 3px rgba(0,0,0,0.1),
    0 6px 12px rgba(0,0,0,0.15);
}
.hud-btn.active{
  background:rgba(255,165,100,0.18);
  color:#ff6a2f;font-weight:600;
  box-shadow:
    inset 0 0 4px rgba(255,150,80,0.6),
    0 0 14px 3px rgba(255,150,80,0.3);
}

/* =========================================================
[TICKER]
========================================================= */
#ticker{
  position:fixed;left:16px;bottom:14px;
  width:45vw;max-width:700px;max-height:50vh;
  display:flex;flex-direction:column-reverse;
  overflow:hidden;
  color:#ff3a2f;font-size:18px;line-height:1.25;
  z-index:900;
}
.tline{opacity:.95;margin:0;animation:fadeIn .6s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* =========================================================
[PROMPT BAR]
========================================================= */
#promptWrap{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  pointer-events:none;z-index:800;
}
#promptBox{
  pointer-events:auto;
  display:flex;align-items:center;gap:10px;
  padding:10px 16px;
  background:rgba(240,250,255,0.55);
  border:1px solid rgba(255,255,255,0.6);
  border-radius:12px;
  backdrop-filter:blur(8px);
  box-shadow:0 8px 24px rgba(0,30,60,.18);
}
#input{
  background:transparent;border:none;outline:none;
  font:inherit;font-size:18px;color:#111;width:24ch;
}
#caret{width:.5ch;height:1.2em;background:#222;animation:blink 1s step-end infinite;}
@keyframes blink{50%{opacity:0}}

/* =========================================================
[MINI WINDOW]
========================================================= */
.miniWin{
  position:absolute;
  width:22vw;max-width:380px;aspect-ratio:9/16;
  background:rgba(255,255,255,0.2);
  border:1px solid rgba(255,255,255,0.55);
  border-radius:16px;
  backdrop-filter:blur(12px);
  box-shadow:0 18px 40px rgba(0,0,0,0.25);
  overflow:hidden;cursor:grab;z-index:500;
}
.miniWin:active{cursor:grabbing;}
.miniBar{
  display:flex;align-items:center;justify-content:space-between;
  padding:4px 10px;height:26px;
  background:rgba(255,255,255,0.2);
  font-size:12px;color:#222;user-select:none;
}
.miniTitle{font-weight:600;opacity:.75;}
.miniBtns{display:flex;gap:4px;}
.win-dot{width:6px;height:6px;border-radius:50%;background:#999;opacity:.7;}
.miniInner{position:relative;width:100%;height:calc(100% - 26px);}
.miniVideo{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transform:scaleX(-1);}

/* =========================================================
[RESPONSIVE]
========================================================= */
@media(max-width:1024px){
  #hudShell{top:10px;right:10px;min-width:220px;padding:12px 10px;}
  .hud-btn{font-size:14px;padding:7px 8px;}
  #ticker{font-size:16px;width:90vw;}
}
</style>
</head>
<body>

<!-- [L0] MAIN CAMERA -->
<video id="cameraMain" autoplay muted playsinline></video>

<!-- [L1] HUD -->
<div id="hudShell">
  <div id="hudIndex">HUD 1 / 3</div>
  <div id="hudHeader">Mode &gt; Shift</div>

  <!-- HUD 1 -->
  <div id="hud1" class="hud-panel active">
    <div class="hud-row">
      <button class="hud-btn active" id="btnSpawn5">‚ûï Spawn 5</button>
      <button class="hud-btn" id="btnReverseCam">üîÅ Reverse Cam</button>
    </div>
    <div class="hud-row">
      <button class="hud-btn" id="btnVoice">üîä Voice On</button>
      <button class="hud-btn" id="btnReset">Reset</button>
    </div>
  </div>

  <!-- HUD 2 Placeholder -->
  <div id="hud2" class="hud-panel">
    <div class="hud-row"><button class="hud-btn">Grid Snap</button></div>
    <div class="hud-row"><button class="hud-btn">Close All</button></div>
  </div>

  <!-- HUD 3 Placeholder -->
  <div id="hud3" class="hud-panel">
    <div class="hud-row"><button class="hud-btn">Mirror</button></div>
    <div class="hud-row"><button class="hud-btn">Zoom</button></div>
  </div>
</div>

<!-- [L3] TICKER -->
<div id="ticker"></div>

<!-- [L4] PROMPT -->
<div id="promptWrap">
  <div id="promptBox">
    <div id="caret"></div>
    <input id="input" type="text" placeholder="type here‚Ä¶" spellcheck="false" autocomplete="off" />
  </div>
</div>

<script>
/* =========================================================
TICKER
========================================================= */
const ticker=document.getElementById('ticker');
function addTicker(t){const l=document.createElement('div');l.className='tline';l.textContent=t;ticker.prepend(l);
if(ticker.children.length>100)ticker.removeChild(ticker.lastChild);}
['CUSeeMe Compact Lumen v1.8','rear camera default','HUD ready','voice system idle']
.forEach((m,i)=>setTimeout(()=>addTicker(m),300*i));

/* =========================================================
CAMERA
========================================================= */
let mediaStream=null;
async function initStream(){
  if(mediaStream){mediaStream.getTracks().forEach(t=>t.stop());}
  try{
    mediaStream=await navigator.mediaDevices.getUserMedia({
      video:{facingMode:{ideal:'environment'}},audio:false
    });
    document.getElementById('cameraMain').srcObject=mediaStream;
    document.querySelectorAll('.miniVideo').forEach(v=>v.srcObject=mediaStream);
    addTicker('camera stream: granted (rear)');
  }catch(e){addTicker('‚ö† camera denied');}
}
initStream();

/* =========================================================
VOICE SYSTEM
========================================================= */
let voiceOn=true,voicesReady=false;
function primeVoices(){return new Promise(res=>{
  const id=setInterval(()=>{
    const v=speechSynthesis.getVoices();
    if(v&&v.length){clearInterval(id);voicesReady=true;res();}
  },100);
});}
speechSynthesis.onvoiceschanged=primeVoices;
async function speak(t){if(!voiceOn||!('speechSynthesis'in window))return;
if(!voicesReady)await primeVoices();
const u=new SpeechSynthesisUtterance(t);
u.lang='en-US';u.rate=1.05;u.pitch=0.9;u.volume=0.85;
const v=speechSynthesis.getVoices();
u.voice=v.find(x=>/samantha/i.test(x.name))||v.find(x=>/google/i.test(x.name))||v[0];
speechSynthesis.speak(u);}
window.addEventListener('click',()=>speechSynthesis.cancel(),{once:true});

/* =========================================================
MINI WINDOWS
========================================================= */
let winCount=0,spawned=false;
function makeMiniWindow(x=80,y=80){
  winCount++;
  const el=document.createElement('div');
  el.className='miniWin';
  el.style.left=x+'px';el.style.top=y+'px';
  el.innerHTML=`
  <div class="miniBar">
    <div class="miniTitle">subject_${String(winCount).padStart(4,'0')}</div>
    <div class="miniBtns"><div class="win-dot"></div><div class="win-dot"></div><div class="win-dot"></div></div>
  </div>
  <div class="miniInner"><video class="miniVideo" autoplay muted playsinline></video></div>`;
  document.body.appendChild(el);
  const v=el.querySelector('.miniVideo');if(mediaStream)v.srcObject=mediaStream;

  // drag
  const bar=el.querySelector('.miniBar');let dragging=false,sx=0,sy=0,sl=0,st=0;
  bar.addEventListener('pointerdown',e=>{
    dragging=true;const r=el.getBoundingClientRect();
    sl=r.left;st=r.top;sx=e.clientX;sy=e.clientY;
    function move(e){if(!dragging)return;el.style.left=(sl+(e.clientX-sx))+'px';el.style.top=(st+(e.clientY-sy))+'px';}
    function stop(){dragging=false;document.removeEventListener('pointermove',move);document.removeEventListener('pointerup',stop);}
    document.addEventListener('pointermove',move);document.addEventListener('pointerup',stop);
  });
  return el;
}

/* =========================================================
BUTTON LOGIC
========================================================= */
const btnSpawn5=document.getElementById('btnSpawn5');
btnSpawn5.addEventListener('click',()=>{
  if(spawned)return;spawned=true;
  const startX=60+Math.random()*40,startY=100+Math.random()*40;
  for(let i=0;i<5;i++){makeMiniWindow(startX+i*26,startY+i*18);}
  addTicker('spawned 5 windows');
});
document.getElementById('btnReverseCam').addEventListener('click',async()=>{
  addTicker('camera reverse');
  await initStream();
});
document.getElementById('btnVoice').addEventListener('click',()=>{
  voiceOn=!voiceOn;
  addTicker(`voice ${voiceOn?'on':'off'}`);
});
document.getElementById('btnReset').addEventListener('click',()=>{
  document.querySelectorAll('.miniWin').forEach(n=>n.remove());
  spawned=false;addTicker('reset');
});

/* =========================================================
HUD SWAP
========================================================= */
const huds=[...document.querySelectorAll('.hud-panel')];
const hudIndex=document.getElementById('hudIndex');
let currentHUD=0;
document.getElementById('hudHeader').addEventListener('click',()=>{
  huds[currentHUD]?.classList.remove('active');
  currentHUD=(currentHUD+1)%huds.length;
  huds[currentHUD]?.classList.add('active');
  hudIndex.textContent=`HUD ${currentHUD+1} / ${huds.length}`;
  addTicker(`HUD switched ‚Üí ${currentHUD+1}`);
});
</script>
</body>
</html>
