<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CUSeeMe v2.0 ‚Äî Semantic Voice Core (Ticker + Speak)</title>
<style>
  :root{
    --bg:#f9fafc;
    --hud:#ffffffcc;
    --ink:#1b1d22;
    --soft-dark: rgba(0,0,0,.15);
    --soft-light: rgba(255,255,255,.85);
    --accent:#ff6a2f;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
    font-family:"VT323",ui-monospace,Menlo,Consolas,monospace;}
  /* Layout: a small top bar (HUD) + big ticker that can fill entire page */
  .wrap{
    display:grid;
    grid-template-rows:auto 1fr;
    height:100vh;
  }

  /* Neumorphic, fixed header (not draggable) */
  #hud{
    position:sticky; top:0; z-index:10;
    display:flex; gap:10px; align-items:center; padding:12px 14px;
    background:var(--hud);
    backdrop-filter: blur(14px) saturate(1.25);
    -webkit-backdrop-filter: blur(14px) saturate(1.25);
    box-shadow:
      6px 6px 16px var(--soft-dark),
      -6px -6px 16px var(--soft-light);
    border-radius:14px;
    margin:10px; 
  }
  #title{font-size:20px; letter-spacing:.4px; margin-right:6px; opacity:.85}

  /* Input and buttons */
  #input{
    flex:1; min-width:0;
    border:none; outline:none; font:inherit; font-size:18px; color:#111;
    background:#f2f6fa; border-radius:12px; padding:10px 12px;
    box-shadow: inset 3px 3px 8px rgba(0,0,0,.12), inset -3px -3px 8px rgba(255,255,255,.8);
  }
  .btn{
    font:inherit; font-size:17px; cursor:pointer;
    border:none; border-radius:12px; padding:10px 12px; background:#f2f6fa; color:#222;
    box-shadow: 4px 4px 10px rgba(0,0,0,.18), -4px -4px 10px rgba(255,255,255,.85);
    transition:transform .2s ease, color .2s ease, box-shadow .2s ease;
  }
  .btn:hover{ transform:translateY(-1px); color:var(--accent); }
  .btn:active{
    box-shadow: inset 2px 2px 6px rgba(0,0,0,.18), inset -2px -2px 6px rgba(255,255,255,.85);
    background: rgba(255,165,100,.15);
  }
  .btn.on{ color:#fff; background:var(--accent); }

  /* Ticker fills page and grows upward from top (no constraint) */
  #ticker{
    margin:10px; padding:14px; overflow:auto; height:100%;
    background:#fff; border-radius:14px;
    box-shadow: inset 6px 6px 16px rgba(0,0,0,.08), inset -6px -6px 16px rgba(255,255,255,.9);
  }
  .tline{margin:0 0 6px 0; line-height:1.25; font-size:18px; word-wrap:break-word; }
  .user{color:#0d3b66}
  .sys{color:#ff3a2f}
  .note{color:#666}

  /* Small help row */
  #help{opacity:.7; font-size:16px}
</style>
</head>
<body>
<div class="wrap">
  <div id="hud">
    <div id="title">Semantic Voice</div>
    <input id="input" placeholder="speak or type‚Ä¶ then Enter" autocomplete="off" />
    <button id="btnMic" class="btn" title="Start/Stop mic">üéôÔ∏è Mic</button>
    <button id="btnMute" class="btn" title="Toggle spoken replies">üîä Voice On</button>
    <button id="btnClear" class="btn" title="Clear ticker">üßπ Clear</button>
  </div>

  <div id="ticker">
    <p class="tline note">v2.0 online ‚Äî voice+text ‚Üí semantic core ‚Üí ticker + spoken reply</p>
    <p class="tline note" id="help">Tip: try ‚Äúhello‚Äù, ‚Äútime?‚Äù, ‚Äúrepeat after me ‚Ä¶‚Äù or anything ‚Äî I‚Äôll echo.</p>
  </div>
</div>

<script>
/* =============== Utilities =============== */
const ticker = document.getElementById('ticker');
function addTicker(html, cls="sys"){
  const p = document.createElement('p');
  p.className = `tline ${cls}`;
  p.innerHTML = html;
  ticker.appendChild(p);
  // autoscroll to bottom
  ticker.scrollTop = ticker.scrollHeight;
}

/* =============== Speech Synthesis (speak back) =============== */
let speakEnabled = true;
document.getElementById('btnMute').addEventListener('click', ()=>{
  speakEnabled = !speakEnabled;
  document.getElementById('btnMute').textContent = speakEnabled ? 'üîä Voice On' : 'üîá Voice Off';
  addTicker(`Spoken replies ${speakEnabled?'enabled':'disabled'}`, 'note');
});
let voicesReady = false;
function waitVoices(){
  return new Promise(res=>{
    const id = setInterval(()=>{
      if (speechSynthesis.getVoices().length){ clearInterval(id); voicesReady=true; res(); }
    },100);
  });
}
async function speak(text){
  if(!speakEnabled || !('speechSynthesis' in window)) return;
  if(!voicesReady) await waitVoices();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US';
  u.rate = 1.02;
  u.pitch = 0.95;
  const v = speechSynthesis.getVoices();
  u.voice = v.find(x=>/Samantha|Kate|Google US English/i.test(x.name)) || v[0];
  speechSynthesis.speak(u);
}

/* =============== Semantic Router =============== */
/* Only updates ticker + speaks a reply. No side effects. */
function semanticRouter(raw){
  const text = (raw||'').trim();
  if(!text) return;
  // Log user input
  addTicker('> ' + text, 'user');

  const lower = text.toLowerCase();

  // simple sample semantics (customize as you like)
  if (lower === 'hello' || lower.startsWith('hi')) {
    const reply = "Hello. I'm listening.";
    addTicker(reply, 'sys'); speak(reply); return;
  }
  if (lower.includes('time')) {
    const now = new Date();
    const reply = 'Current time: ' + now.toLocaleTimeString();
    addTicker(reply, 'sys'); speak(reply); return;
  }
  if (lower.startsWith('repeat after me')) {
    const say = text.replace(/^repeat after me/i, '').trim();
    const reply = say || '‚Ä¶say what?';
    addTicker(reply, 'sys'); speak(reply); return;
  }

  // default echo
  const reply = 'You said: ' + text;
  addTicker(reply, 'sys'); speak(reply);
}

/* =============== Text Input Handler =============== */
const input = document.getElementById('input');
input.addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){
    e.preventDefault();
    semanticRouter(input.value);
    input.value = '';
  }
});

/* =============== Voice Input via Web Speech (if available) =============== */
const btnMic = document.getElementById('btnMic');
let rec = null, listening = false;

// Support vendor prefixed (Safari iOS: webkitSpeechRecognition when available)
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SR) {
  btnMic.disabled = false; // still clickable to show a note
  btnMic.addEventListener('click', ()=>{
    addTicker('Microphone recognition not available on this browser. Typing still works.', 'note');
  });
} else {
  rec = new SR();
  rec.lang = 'en-US';
  rec.interimResults = true;
  rec.continuous = true;

  rec.onstart = () => { listening = true; btnMic.classList.add('on'); addTicker('üéôÔ∏è Voice capture started', 'note'); };
  rec.onend   = () => { listening = false; btnMic.classList.remove('on'); addTicker('‚èπÔ∏è Voice capture stopped', 'note'); };

  let interim = '';
  rec.onresult = (evt)=>{
    let finalChunk = '';
    for (let i = evt.resultIndex; i < evt.results.length; i++) {
      const t = evt.results[i][0].transcript;
      if (evt.results[i].isFinal) finalChunk += t;
      else interim = t;
    }
    if (interim) {
      // show faint interim (optional)
      // We‚Äôll not spam ticker; could add inline status if desired.
    }
    if (finalChunk) {
      semanticRouter(finalChunk);
      interim = '';
    }
  };

  rec.onerror = (e)=>{ addTicker('Voice error: ' + e.error, 'note'); };

  btnMic.addEventListener('click', ()=>{
    try{
      if(!listening){ rec.start(); }
      else { rec.stop(); }
    }catch(err){
      addTicker('Mic error: ' + (err.message||err), 'note');
    }
  });
}

/* =============== Clear Ticker =============== */
document.getElementById('btnClear').addEventListener('click', ()=>{
  ticker.innerHTML = '';
});

</script>
</body>
</html>
