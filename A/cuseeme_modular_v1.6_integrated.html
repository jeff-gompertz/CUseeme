<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CUSeeMe Modular v1.6 — Integrated</title>
<style>
  :root{
    --hud-accent: 255,255,255;
    --hud-dim: 220,220,230;
    --glass: 255,255,255;
    --pane-border: 255,255,255;
    --shadow: 0,0,0;
    --titlebar-height: 34px;
  }
  html,body{
    margin:0; padding:0; height:100%; background:#0b0b0e; color:#fff; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    overflow:hidden;
  }

  /* ===== Base stage ===================================================== */
  .stage{
    position:fixed; inset:0;
    background:
      radial-gradient(1000px 600px at 15% 20%, rgba(70,70,90,.15), transparent 60%),
      radial-gradient(900px 700px at 80% 70%, rgba(60,80,110,.12), transparent 60%),
      #0b0b0e;
  }

  /* ===== HUD Chrome (shared) ============================================ */
  .hud{
    position:fixed; inset:0; pointer-events:none; display:flex; flex-direction:column; justify-content:space-between;
    opacity:1; transition:opacity .18s ease;
  }
  .hud.is-hidden{ opacity:0; }
  .hud-row{
    display:flex; align-items:center; justify-content:space-between; gap:.8rem;
    padding:14px 18px;
    pointer-events:none;
  }
  .hud .chunk{
    display:flex; align-items:center; gap:.5rem; pointer-events:auto;
    backdrop-filter: blur(9px) saturate(1.1);
    -webkit-backdrop-filter: blur(9px) saturate(1.1);
    background: rgba(var(--glass), .08);
    border: 1px solid rgba(var(--hud-dim), .18);
    box-shadow: 0 8px 28px rgba(var(--shadow), .35), inset 0 1px 0 rgba(255,255,255,.06);
    border-radius: 12px;
    padding:8px 10px;
  }
  .hud .left, .hud .right{ gap:.6rem; }

  .tag{
    font-size:12px; letter-spacing:.12em; text-transform:uppercase; opacity:.7;
    padding:6px 9px; border:1px solid rgba(var(--hud-dim),.2); border-radius:8px;
  }
  .kbd{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    font-size:12px; padding:6px 8px; border-radius:8px; border:1px solid rgba(var(--hud-dim),.25); background:rgba(255,255,255,.04);
  }
  .btn{
    user-select:none; cursor:pointer; font-size:13px; padding:8px 12px; border-radius:10px;
    border:1px solid rgba(var(--hud-dim),.25); background:rgba(var(--glass),.07);
    transition:transform .08s ease, background .12s ease, border-color .12s ease;
  }
  .btn:hover{ transform:translateY(-1px); background:rgba(var(--glass),.1); }
  .btn:active{ transform:translateY(0); }
  .spacer{ width:10px; height:1px; }

  .mode-indicator{
    font-size:12px; letter-spacing:.18em; text-transform:uppercase; opacity:.9;
    padding:6px 10px; border-radius:8px; border:1px dashed rgba(var(--hud-dim),.35);
  }

  /* ===== Window System (HUD2) =========================================== */
  .wm-layer{
    position:fixed; inset:0; pointer-events:none; /* windows enable on selves */
  }
  .pane{
    position:absolute; width:380px; min-width:260px; height:240px; max-height:70vh;
    display:flex; flex-direction:column; overflow:hidden;
    border-radius:16px;
    background: rgba(var(--glass), .07);
    backdrop-filter: blur(12px) saturate(1.1);
    -webkit-backdrop-filter: blur(12px) saturate(1.1);
    border:1px solid rgba(var(--pane-border), .20);
    box-shadow:
      0 18px 55px rgba(0,0,0,.45),
      inset 0 1px 0 rgba(255,255,255,.06);
    pointer-events:auto;
    will-change: transform, left, top;
  }
  .pane .titlebar{
    height: var(--titlebar-height);
    display:flex; align-items:center; justify-content:space-between; gap:.6rem;
    padding:0 10px; cursor:grab;
    background: linear-gradient(to bottom, rgba(255,255,255,.08), rgba(255,255,255,.02));
    border-bottom:1px solid rgba(255,255,255,.12);
    user-select:none;
  }
  .pane .title{
    font-size:13px; letter-spacing:.06em; text-transform:uppercase; opacity:.9;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .pane .controls{ display:flex; gap:6px; align-items:center; }
  .dot{ width:11px; height:11px; border-radius:50%; opacity:.9; }
  .dot.close{ background:#ff5f56; }
  .dot.min{ background:#ffbd2e; }
  .dot.max{ background:#27c93f; }
  .dot.btnish{ cursor:pointer; transition:transform .08s ease; }
  .dot.btnish:hover{ transform:scale(1.06); }

  .pane .content{
    flex:1; overflow:auto; padding:12px 14px; font-size:14px; line-height:1.45;
  }
  .pane.is-dragging .titlebar{ cursor:grabbing; }

  /* Scrollbars subtle */
  .pane .content::-webkit-scrollbar{ width:10px; }
  .pane .content::-webkit-scrollbar-thumb{ background:rgba(255,255,255,.12); border-radius:999px; }
  .pane .content::-webkit-scrollbar-track{ background:transparent; }

  /* ===== HUD variants ==================================================== */
  [data-hud="1"] .hud.hud-1 { display:flex; }
  [data-hud="1"] .hud.hud-2,
  [data-hud="1"] .hud.hud-3 { display:none; }

  [data-hud="2"] .hud.hud-1 { display:none; }
  [data-hud="2"] .hud.hud-2 { display:flex; }
  [data-hud="2"] .hud.hud-3 { display:none; }

  [data-hud="3"] .hud.hud-1,
  [data-hud="3"] .hud.hud-2 { display:none; }
  [data-hud="3"] .hud.hud-3 { display:flex; }

  /* Small helper label bottom-right */
  .corner{
    position:fixed; right:12px; bottom:10px; opacity:.55; font-size:12px; letter-spacing:.14em; text-transform:uppercase;
    user-select:none; pointer-events:none;
  }

  /* Responsive tweak */
  @media (max-width: 600px){
    .pane{ width:86vw; height:46vh; }
  }
</style>
</head>
<body data-hud="1">
  <div class="stage" id="stage"></div>

  <!-- ================= HUD 1 : baseline (v1.5-identical minimal chrome) =============== -->
  <section class="hud hud-1" id="hud1">
    <div class="hud-row">
      <div class="chunk left">
        <span class="tag">CUSeeMe Modular</span>
        <span class="mode-indicator" id="modeLabel1">HUD 1 — Base</span>
      </div>
      <div class="chunk right">
        <span class="kbd">Shift</span> swap to HUD2
        <div class="spacer"></div>
        <button class="btn" data-jump="2" title="Switch to HUD2">Mode ▸ HUD2</button>
        <button class="btn" id="toggleHudBtn1" title="Hide/Show HUD (H)">HUD ⌘</button>
      </div>
    </div>
  </section>

  <!-- ================= HUD 2 : integrated multi-window system ======================== -->
  <section class="hud hud-2" id="hud2">
    <div class="hud-row">
      <div class="chunk left">
        <span class="tag">CUSeeMe Modular</span>
        <span class="mode-indicator" id="modeLabel2">HUD 2 — Multi-Window</span>
        <button class="btn" id="spawnBtn">Spawn</button>
        <button class="btn" id="driftBtn">Pause drift</button>
        <button class="btn" id="clearBtn">Clear</button>
      </div>
      <div class="chunk right">
        <span class="kbd">Drag</span> move
        <span class="kbd">×</span> close
        <span class="kbd">Shift</span> swap HUD1/2
        <div class="spacer"></div>
        <button class="btn" data-jump="1">Mode ▸ HUD1</button>
        <button class="btn" data-jump="3">Mode ▸ HUD3</button>
        <button class="btn" id="toggleHudBtn2">HUD ⌘</button>
      </div>
    </div>
  </section>

  <!-- ================= HUD 3 : placeholder / untouched ============================== -->
  <section class="hud hud-3" id="hud3">
    <div class="hud-row">
      <div class="chunk left">
        <span class="tag">CUSeeMe Modular</span>
        <span class="mode-indicator">HUD 3 — Placeholder</span>
      </div>
      <div class="chunk right">
        <button class="btn" data-jump="1">Mode ▸ HUD1</button>
        <button class="btn" data-jump="2">Mode ▸ HUD2</button>
        <button class="btn" id="toggleHudBtn3">HUD ⌘</button>
      </div>
    </div>
  </section>

  <!-- Window manager layer used by HUD2 -->
  <div class="wm-layer" id="wmLayer" aria-hidden="true"></div>

  <div class="corner" id="corner">v1.6 integrated</div>

<script>
/* ============================================================================
   CUSeeMe Modular v1.6 — Integrated HUDs + Native Multi-Window System
   - No iframes; consistent theme & CSS
   - HUD1: baseline minimal chrome (v1.5 parity)
   - HUD2: real multi-window environment
   - HUD3: reserved
   Keyboard:
     Shift -> Quick swap between HUD1 and HUD2
     1/2/3 -> Jump to a HUD directly
     H     -> Toggle HUD visibility
   ========================================================================== */

(function(){
  const root = document.body;
  const wmLayer = document.getElementById('wmLayer');
  const corner = document.getElementById('corner');

  /* =============== HUD switching =================== */
  const setHUD = (n)=>{
    root.setAttribute('data-hud', String(n));
    corner.textContent = `v1.6 — HUD ${n}`;
  };
  const getHUD = ()=> Number(root.getAttribute('data-hud') || '1');

  // Buttons to jump HUD
  document.querySelectorAll('[data-jump]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const n = Number(btn.getAttribute('data-jump'));
      setHUD(n);
    });
  });

  // Toggle HUD visibility with H or button
  const toggleHUD = ()=>{
    const current = getHUD();
    const hudEl = document.getElementById(`hud${current}`);
    hudEl.classList.toggle('is-hidden');
  };

  ['toggleHudBtn1','toggleHudBtn2','toggleHudBtn3'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.addEventListener('click', toggleHUD);
  });

  // Keyboard handlers
  window.addEventListener('keydown', (e)=>{
    if(e.key === '1'){ setHUD(1); }
    else if(e.key === '2'){ setHUD(2); }
    else if(e.key === '3'){ setHUD(3); }
    else if(e.key.toLowerCase() === 'h'){ toggleHUD(); }
    else if(e.key === 'Shift'){ // quick swap 1 <-> 2
      const cur = getHUD();
      setHUD(cur === 1 ? 2 : 1);
    }
  });

  /* =============== Window Manager (HUD2) =================== */
  class WindowManager{
    constructor(layer){
      this.layer = layer;
      this.windows = new Set();
      this._id = 0;
      this.driftOn = true;

      this.bounds = { w: window.innerWidth, h: window.innerHeight };
      window.addEventListener('resize', ()=>{
        this.bounds = { w: window.innerWidth, h: window.innerHeight };
      });

      this._raf = null;
      this._tick = this._tick.bind(this);
      this.play();
    }

    play(){
      if(!this._raf){
        this._raf = requestAnimationFrame(this._tick);
      }
      this.driftOn = true;
    }
    pause(){
      this.driftOn = false;
      if(this._raf){ cancelAnimationFrame(this._raf); this._raf = null; }
    }
    toggle(){
      this.driftOn ? this.pause() : this.play();
    }

    spawn(opts={}){
      const id = ++this._id;
      const pane = document.createElement('div');
      pane.className = 'pane';
      pane.style.left = (opts.x ?? Math.random() * (this.bounds.w - 420) + 20) + 'px';
      pane.style.top  = (opts.y ?? Math.random() * (this.bounds.h - 300) + 20) + 'px';

      // velocity (drift)
      const speed = 0.25 + Math.random()*0.55;
      const angle = Math.random()*Math.PI*2;
      const vx = Math.cos(angle)*speed;
      const vy = Math.sin(angle)*speed;

      pane.dataset.vx = vx; pane.dataset.vy = vy;
      pane.dataset.id = id;

      pane.innerHTML = `
        <div class="titlebar" draggable="false">
          <div class="controls">
            <div class="dot btnish close" title="Close"></div>
            <div class="dot min" title="Minimize (visual only)"></div>
            <div class="dot max" title="Maximize (visual only)"></div>
          </div>
          <div class="title">Window ${id} — Translucent Pane</div>
          <div class="controls">
            <div class="dot btnish" style="background:#7aa7ff" title="Duplicate"></div>
          </div>
        </div>
        <div class="content">
          <p><b>Floating pane ${id}</b></p>
          <p>This is the real multi-window environment: drag me, close me, or let me drift and bounce inside the viewport. Styles are native—no iframes.</p>
          <p>Tip: Use <span class="kbd">Shift</span> to swap HUD1/HUD2, <span class="kbd">H</span> to hide/show HUD chrome.</p>
        </div>
      `;

      // interactions
      const titlebar = pane.querySelector('.titlebar');
      const closeBtn = pane.querySelector('.dot.close');
      const dupBtn   = pane.querySelector('.controls .dot.btnish:last-child');

      // Bring to front on mousedown
      pane.addEventListener('mousedown', ()=> this.bringToFront(pane));

      // Dragging
      let dragging = false;
      let startX=0, startY=0, origLeft=0, origTop=0;
      const onMove = (ev)=>{
        if(!dragging) return;
        const x = (ev.touches?.[0]?.clientX ?? ev.clientX);
        const y = (ev.touches?.[0]?.clientY ?? ev.clientY);
        const dx = x - startX, dy = y - startY;
        pane.style.left = (origLeft + dx) + 'px';
        pane.style.top  = (origTop  + dy) + 'px';
      };
      const onUp = ()=>{
        if(!dragging) return;
        dragging = false;
        pane.classList.remove('is-dragging');
        window.removeEventListener('mousemove', onMove);
        window.removeEventListener('mouseup', onUp);
        window.removeEventListener('touchmove', onMove);
        window.removeEventListener('touchend', onUp);
      };
      const onDown = (ev)=>{
        ev.preventDefault();
        dragging = true;
        pane.classList.add('is-dragging');
        this.bringToFront(pane);
        startX = (ev.touches?.[0]?.clientX ?? ev.clientX);
        startY = (ev.touches?.[0]?.clientY ?? ev.clientY);
        const rect = pane.getBoundingClientRect();
        origLeft = rect.left; origTop = rect.top;

        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onUp);
        window.addEventListener('touchmove', onMove, {passive:false});
        window.addEventListener('touchend', onUp);
      };
      titlebar.addEventListener('mousedown', onDown);
      titlebar.addEventListener('touchstart', onDown, {passive:false});

      // Close
      closeBtn.addEventListener('click', ()=> this.close(pane));

      // Duplicate
      dupBtn.addEventListener('click', ()=>{
        const rect = pane.getBoundingClientRect();
        this.spawn({ x: rect.left + 26, y: rect.top + 26 });
      });

      // add and z-order
      this.layer.appendChild(pane);
      this.windows.add(pane);
      this.bringToFront(pane);

      return pane;
    }

    close(pane){
      if(this.windows.has(pane)){
        this.windows.delete(pane);
        pane.remove();
      }
    }

    clear(){
      [...this.windows].forEach(w=> w.remove());
      this.windows.clear();
    }

    bringToFront(pane){
      // naive z-index stack
      const maxZ = [...this.windows].reduce((m, w)=>{
        const z = parseInt(getComputedStyle(w).zIndex || '0',10);
        return Math.max(m, isNaN(z)?0:z);
      }, 10);
      pane.style.zIndex = String(maxZ + 1);
    }

    _tick(){
      if(this.driftOn){
        const bw = this.bounds.w, bh = this.bounds.h;
        this.windows.forEach(pane=>{
          // skip if being dragged
          if(pane.classList.contains('is-dragging')) return;

          const rect = pane.getBoundingClientRect();
          let x = rect.left, y = rect.top;
          let vx = Number(pane.dataset.vx||0.3), vy = Number(pane.dataset.vy||0.2);

          x += vx; y += vy;

          const w = rect.width, h = rect.height;
          // bounce
          if(x <= 0){ x = 0; vx = Math.abs(vx); }
          else if(x + w >= bw){ x = bw - w; vx = -Math.abs(vx); }
          if(y <= 0){ y = 0; vy = Math.abs(vy); }
          else if(y + h >= bh){ y = bh - h; vy = -Math.abs(vy); }

          pane.style.left = x + 'px';
          pane.style.top  = y + 'px';
          pane.dataset.vx = vx;
          pane.dataset.vy = vy;
        });
      }
      this._raf = requestAnimationFrame(this._tick);
    }
  }

  const wm = new WindowManager(wmLayer);

  // HUD2 controls
  const spawnBtn = document.getElementById('spawnBtn');
  const driftBtn = document.getElementById('driftBtn');
  const clearBtn = document.getElementById('clearBtn');

  if(spawnBtn) spawnBtn.addEventListener('click', ()=> wm.spawn());
  if(clearBtn) clearBtn.addEventListener('click', ()=> wm.clear());
  if(driftBtn) driftBtn.addEventListener('click', ()=>{
    wm.toggle();
    driftBtn.textContent = wm.driftOn ? 'Pause drift' : 'Play drift';
  });

  // Gentle onboarding: when entering HUD2 for first time, spawn a couple.
  let seeded = false;
  const observer = new MutationObserver(()=>{
    if(document.body.getAttribute('data-hud') === '2' && !seeded){
      seeded = true;
      wm.spawn({ x: 56, y: 80 });
      wm.spawn({ x: 380, y: 160 });
      wm.spawn({ x: 720, y: 120 });
    }
  });
  observer.observe(document.body, { attributes:true, attributeFilter:['data-hud'] });

  // Start at HUD1 (default). Optional: press Shift once to preview HUD2 on load
  // setHUD(1);
})();
</script>
</body>
</html>
