<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CUSeeMe Modular v2.2 â€” Reactive Semantic Feed</title>

<style>
/* =========================================================
CUSeeMe Modular v2.2 â€” Reactive Semantic Feed
========================================================= */
:root {
  --hud-glass: rgba(185, 225, 255, 0.45);
  --hud-border-light: rgba(255, 255, 255, 0.65);
  --hud-border-dark: rgba(0, 45, 90, 0.35);
  --hud-shadow: 0 12px 45px rgba(0, 50, 90, 0.35);
  --hud-text: #1b1d22;
  --btn-bg: rgba(215, 235, 255, 0.35);
  --btn-inset-light: rgba(255,255,255,0.8);
  --btn-inset-dark: rgba(0,30,60,0.3);
  --bg: #f7f7f4;
  --ticker: #ff3a2f;
}

html,body{
  height:100%; margin:0;
  background: var(--bg);
  font-family: "VT323", ui-monospace, Menlo, Consolas, monospace;
  color:#222;
  overflow:hidden;
}

/* === HUD shell === */
#hudShell{
  position:fixed;
  top:24px; right:32px;
  z-index:1000;
  display:grid;
  gap:14px;
  padding:26px;
  min-width:320px;
  background:var(--hud-glass);
  border-radius:20px;
  border:1px solid var(--hud-border-light);
  box-shadow:
    inset 0 1px 3px var(--hud-border-light),
    inset 0 -1px 3px var(--hud-border-dark),
    var(--hud-shadow);
  backdrop-filter:blur(20px) saturate(1.25);
  -webkit-backdrop-filter:blur(20px) saturate(1.25);
  color:var(--hud-text);
  text-align:center;
}
#hudHeader{font-size:22px; margin-bottom:8px;}
.hud-row{display:flex; gap:10px; justify-content:space-between;}
.hud-btn{
  flex:1;
  font-family:"VT323", monospace;
  font-size:17px;
  color:#132030;
  background:var(--btn-bg);
  border:none;
  border-radius:10px;
  box-shadow:
    inset 1px 1px 2px var(--btn-inset-light),
    inset -1px -2px 3px var(--btn-inset-dark),
    0 3px 6px rgba(0,0,0,0.08);
  padding:10px 12px;
  cursor:pointer;
  transition:all .22s ease;
}
.hud-btn:hover{transform:translateY(-1px);}
.hud-btn.active{
  background:rgba(255,165,100,0.15);
  color:#ff6a2f;
  box-shadow:0 0 12px rgba(255,165,100,0.4);
}

/* === Ticker === */
#ticker{
  position:fixed; left:16px; bottom:14px; z-index:900;
  width:45vw; max-width:700px; max-height:50vh;
  display:flex; flex-direction:column-reverse; overflow:hidden;
  color:var(--ticker);
  font-size:18px; line-height:1.25;
}
.tline{opacity:.95;margin:0;animation:fadeIn .6s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* === Hide unwanted Bloople output === */
body > a,
body > b,
body > h1,
body > p,
body > div[id^="rss"],
script[src*="bloople"],
script[src*="feeds.bbci"],
a[href*="bbc.co.uk"],
a[href*="bbci.co.uk"] {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  position: absolute !important;
  z-index: -9999 !important;
  height: 0 !important;
  overflow: hidden !important;
}
</style>
</head>

<body>
<!-- === HUD === -->
<div id="hudShell">
  <div id="hudHeader">Semantic Feed â€” BBC Reactive</div>
  <input id="input" placeholder="speak or typeâ€¦ then Enter" autocomplete="off" />
  <div class="hud-row">
    <button id="btnMic" class="hud-btn" title="Start/Stop mic">ğŸ™ï¸ Mic</button>
    <button id="btnMute" class="hud-btn" title="Toggle spoken replies">ğŸ”Š Voice On</button>
    <button id="btnClear" class="hud-btn" title="Clear ticker">ğŸ§¹ Clear</button>
  </div>
</div>

<!-- === Ticker === -->
<div id="ticker"></div>

<!-- === Hidden RSS Source === -->
<div id="rssSource" style="display:none;"></div>
<script src="//rss.bloople.net/?url=https%3A%2F%2Ffeeds.bbci.co.uk%2Fnews%2Fworld%2Frss.xml&showtitle=false&type=js"></script>

<script>
/* =========================================================
Reactive Semantic Feed â€” Voice + Text + RSS Response
========================================================= */
const ticker=document.getElementById('ticker');
function addTicker(txt,cls="sys"){
  const line=document.createElement('div');
  line.className='tline '+cls;
  line.textContent=txt;
  ticker.prepend(line);
  if(ticker.children.length>80)ticker.removeChild(ticker.lastChild);
}

/* === Speech === */
let speakEnabled=true,voicesReady=false;
function waitVoices(){return new Promise(r=>{
  const id=setInterval(()=>{if(speechSynthesis.getVoices().length){clearInterval(id);voicesReady=true;r();}},100);
});}
async function speak(txt){
  if(!speakEnabled)return;
  if(!voicesReady)await waitVoices();
  const u=new SpeechSynthesisUtterance(txt);
  u.lang='en-GB';u.rate=1.02;u.pitch=0.95;
  u.voice=speechSynthesis.getVoices().find(v=>/Samantha|Kate|Google UK English/i.test(v.name))||null;
  speechSynthesis.speak(u);
}

/* === Input Handler === */
const input=document.getElementById('input');
input.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    e.preventDefault();
    const val=input.value.trim();
    if(!val)return;
    addTicker('> '+val,'user');
    reactToInput(val);
    input.value='';
  }
});

/* === Voice Recognition === */
const btnMic=document.getElementById('btnMic');
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
let rec=null,listening=false;
if(SR){
  rec=new SR();rec.lang='en-US';rec.interimResults=true;rec.continuous=true;
  rec.onstart=()=>{listening=true;btnMic.classList.add('active');addTicker('ğŸ™ï¸ Listeningâ€¦','note');};
  rec.onend=()=>{listening=false;btnMic.classList.remove('active');addTicker('â¹ï¸ Stopped.','note');};
  rec.onresult=(evt)=>{
    let text='';for(let i=evt.resultIndex;i<evt.results.length;i++)
      if(evt.results[i].isFinal)text+=evt.results[i][0].transcript;
    if(text){addTicker('> '+text,'user');reactToInput(text);}
  };
  btnMic.addEventListener('click',()=>{!listening?rec.start():rec.stop();});
}else btnMic.addEventListener('click',()=>addTicker('Voice input unavailable','note'));

/* === Voice Toggle === */
document.getElementById('btnMute').addEventListener('click',()=>{
  speakEnabled=!speakEnabled;
  addTicker(`Spoken replies ${speakEnabled?'enabled':'disabled'}`,'note');
});

/* === Clear === */
document.getElementById('btnClear').addEventListener('click',()=>ticker.innerHTML='');

/* === Reactive Core === */
function reactToInput(userInput){
  const text=userInput.toLowerCase();
  const headlines=Array.from(document.querySelectorAll('a')).map(a=>a.textContent).slice(0,15);
  const random=headlines[Math.floor(Math.random()*headlines.length)]||'...';
  let reply='';

  if(text.includes('war')) reply=`War context detected. ${random}`;
  else if(text.includes('weather')) reply=`Forecast mode: ${random}`;
  else if(text.includes('who')) reply=`Identity trace â†’ ${random}`;
  else if(text.includes('where')) reply=`Location query. ${random}`;
  else reply=`${random}`;

  addTicker(reply,'sys');
  speak(reply);
}

/* === Initialize === */
setTimeout(()=>addTicker('BBC reactive feed online','note'),500);
</script>
</body>
</html>
