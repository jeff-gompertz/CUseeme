<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CUSeeMe Modular v1.7.1 ‚Äî Compact Lumen Refine</title>

<style>
/* =========================================================
   GLOBAL: Pure white background + universal font
========================================================= */
:root {
  --hud-glass: rgba(255, 255, 255, 0.35);
  --hud-border-light: rgba(255, 255, 255, 0.65);
  --hud-border-dark: rgba(0, 45, 90, 0.25);
  --hud-shadow: 0 8px 30px rgba(0, 40, 80, 0.25);
  --hud-text: #1b1d22;
  --btn-bg: rgba(230, 240, 255, 0.45);
  --btn-active: rgba(255, 160, 90, 0.15);
  --ticker: #ff3a2f;
}

html, body {
  margin: 0;
  height: 100%;
  background: #ffffff;
  color: var(--hud-text);
  font-family: "VT323", monospace;
  overflow: hidden;
}

/* =========================================================
   HUD PANEL (Compact Lumen layout)
========================================================= */
#hudShell {
  position: fixed;
  top: 18px;
  right: 18px;
  z-index: 1000;
  display: grid;
  gap: 10px;
  padding: 18px 18px 16px;
  background: var(--hud-glass);
  border-radius: 16px;
  border: 1px solid var(--hud-border-light);
  box-shadow: var(--hud-shadow);
  backdrop-filter: blur(18px) saturate(1.1);
  -webkit-backdrop-filter: blur(18px) saturate(1.1);
  transition: all 0.25s ease;
}
@media (max-width: 768px) {
  #hudShell {
    background: rgba(255, 255, 255, 0.25);
    transform: scale(0.9);
    right: 8px;
    top: 8px;
  }
}

#hudIndex {
  position: absolute;
  top: 4px;
  left: 10px;
  font-size: 13px;
  opacity: 0.55;
}

#hudHeader {
  text-align: center;
  font-size: 24px;
  color: #222;
  user-select: none;
  cursor: pointer;
}
#hudHeader:hover {
  color: #ff6a2f;
}

/* Buttons */
.hud-row {
  display: flex;
  justify-content: space-between;
  gap: 8px;
}
.hud-btn {
  flex: 1;
  font-size: 18px;
  background: var(--btn-bg);
  border: none;
  border-radius: 8px;
  padding: 8px 10px;
  cursor: pointer;
  box-shadow: inset 1px 1px 2px rgba(255,255,255,0.6), 0 2px 6px rgba(0,0,0,0.15);
  transition: all 0.2s ease;
}
.hud-btn:hover {
  transform: translateY(-1px);
}
.hud-btn.active {
  background: var(--btn-active);
  color: #ff6a2f;
  font-weight: bold;
}

/* =========================================================
   PROMPT INPUT
========================================================= */
#promptWrap {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 800;
}
#promptBox {
  pointer-events: auto;
  padding: 10px 16px;
  border-radius: 10px;
  background: rgba(240,250,255,0.6);
  border: 1px solid rgba(255,255,255,0.6);
  box-shadow: 0 8px 24px rgba(0,30,60,0.18);
}
#input {
  background: transparent;
  border: none;
  outline: none;
  font-size: 18px;
  color: #111;
  width: 24ch;
}

/* =========================================================
   TICKER (Bottom-left)
========================================================= */
#ticker {
  position: fixed;
  left: 16px;
  bottom: 14px;
  width: 45vw;
  max-width: 700px;
  display: flex;
  flex-direction: column-reverse;
  color: var(--ticker);
  font-size: 18px;
  z-index: 900;
}
.tline {
  opacity: 0.95;
  margin: 0;
  animation: fadeIn 0.6s ease;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(6px); }
  to { opacity: 1; transform: none; }
}

/* =========================================================
   MINI WINDOWS
========================================================= */
.miniWin {
  position: absolute;
  width: 22vw;
  max-width: 360px;
  aspect-ratio: 9 / 16;
  background: rgba(230, 240, 255, 0.4);
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.6);
  box-shadow: 0 12px 30px rgba(0,0,0,0.25);
  overflow: hidden;
  cursor: grab;
}
.miniBar {
  height: 26px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 10px;
  background: rgba(255,255,255,0.2);
  font-size: 12px;
}
.miniInner {
  position: relative;
  width: 100%;
  height: calc(100% - 26px);
}
.miniVideo {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* =========================================================
   CAMERA BACKGROUND
========================================================= */
#cameraMain {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: scaleX(-1);
}
</style>
</head>

<body>

<!-- Camera -->
<video id="cameraMain" autoplay muted playsinline></video>

<!-- HUD -->
<div id="hudShell">
  <div id="hudIndex">HUD 1 / 3</div>
  <div id="hudHeader">Mode &gt; Shift</div>

  <div class="hud-row">
    <button class="hud-btn" id="btnSpawn1">‚ûï New Window</button>
    <button class="hud-btn" id="btnSpawn5">‚ûï‚ûï Spawn 5</button>
  </div>
  <div class="hud-row">
    <button class="hud-btn" id="btnGrid">‚ñ¶ Grid Snap</button>
    <button class="hud-btn" id="btnCloseAll">‚úï Close All</button>
  </div>
  <div class="hud-row">
    <button class="hud-btn" id="btnReverseCam">üîÅ Reverse Cam</button>
    <button class="hud-btn" id="btnVoice">üîä Voice On</button>
  </div>
</div>

<!-- Prompt -->
<div id="promptWrap">
  <div id="promptBox">
    <input id="input" type="text" placeholder="type here‚Ä¶" />
  </div>
</div>

<!-- Ticker -->
<div id="ticker"></div>

<script>
/* =========================================================
   CAMERA INITIALIZATION (rear by default)
========================================================= */
let mediaStream = null;
let facing = 'environment'; // rear camera default

async function initStream() {
  if (mediaStream) {
    mediaStream.getTracks().forEach(t => t.stop());
    mediaStream = null;
  }
  try {
    mediaStream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: { ideal: facing } },
      audio: false
    });
    document.getElementById('cameraMain').srcObject = mediaStream;
    document.querySelectorAll('.miniVideo').forEach(v => v.srcObject = mediaStream);
    addTicker(`camera: ${facing === 'user' ? 'front' : 'rear'} feed ready`);
  } catch (e) {
    addTicker('‚ö† camera denied');
  }
}

/* =========================================================
   MINI WINDOWS (spawn once)
========================================================= */
let winCount = 0;
let spawned = false;
function makeMiniWindow({x=60,y=80}={}) {
  const el = document.createElement('div');
  el.className = 'miniWin';
  el.style.left = x + 'px';
  el.style.top = y + 'px';
  el.innerHTML = `
    <div class="miniBar"><div>subject_${String(++winCount).padStart(4,'0')}</div></div>
    <div class="miniInner"><video class="miniVideo" autoplay muted playsinline></video></div>`;
  document.body.appendChild(el);
  const vid = el.querySelector('.miniVideo');
  if (mediaStream) vid.srcObject = mediaStream;
}
document.getElementById('btnSpawn5').addEventListener('click',()=>{
  if (spawned) return addTicker('spawn: already active');
  spawned = true;
  for (let i=0;i<5;i++) makeMiniWindow({x:80+i*25,y:80+i*20});
  addTicker('spawned 5 windows');
});
document.getElementById('btnSpawn1').addEventListener('click',()=>{
  if (spawned) return addTicker('spawn: already active');
  spawned = true;
  makeMiniWindow({x:100,y:100});
  addTicker('spawned 1 window');
});

/* Grid and close */
document.getElementById('btnGrid').addEventListener('click',()=>{
  const wins=[...document.querySelectorAll('.miniWin')];
  const cols=Math.ceil(Math.sqrt(wins.length));
  let x=20,y=100,g=12;
  wins.forEach((el,i)=>{
    el.style.left=x+'px'; el.style.top=y+'px';
    x+=(innerWidth/cols)-g;
    if(x>innerWidth-200){x=20;y+=300;}
  });
  addTicker('grid snap');
});
document.getElementById('btnCloseAll').addEventListener('click',()=>{
  document.querySelectorAll('.miniWin').forEach(w=>w.remove());
  spawned=false; addTicker('all windows closed');
});

/* Reverse Cam */
document.getElementById('btnReverseCam').addEventListener('click', async ()=>{
  facing = (facing === 'user') ? 'environment' : 'user';
  await initStream();
});

/* =========================================================
   VOICE SYNTH
========================================================= */
let voiceOn=true, voicesReady=false;
function primeVoices(){return new Promise(res=>{
  const id=setInterval(()=>{
    const v=speechSynthesis.getVoices();
    if(v&&v.length){clearInterval(id);voicesReady=true;res();}},100);
});}
async function speak(t){
  if(!voiceOn) return;
  if(!voicesReady) await primeVoices();
  const u=new SpeechSynthesisUtterance(t);
  u.lang='en-US';u.rate=1.05;u.pitch=0.9;u.volume=0.85;
  speechSynthesis.speak(u);
}
const btnVoice=document.getElementById('btnVoice');
btnVoice.addEventListener('click',()=>{
  voiceOn=!voiceOn;
  btnVoice.textContent=voiceOn?'üîä Voice On':'üîá Voice Off';
  addTicker(`voice: ${voiceOn?'on':'off'}`);
});

/* =========================================================
   PROMPT ‚Üí ticker
========================================================= */
const ticker=document.getElementById('ticker');
function addTicker(t){
  const l=document.createElement('div');
  l.className='tline';
  l.textContent=t;
  ticker.prepend(l);
  if(ticker.children.length>80) ticker.removeChild(ticker.lastChild);
}
const input=document.getElementById('input');
input.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    const v=input.value.trim();
    if(v){addTicker('> '+v);speak('acknowledged');}
    input.value='';
  }
});

/* =========================================================
   INIT
========================================================= */
(async()=>{await initStream();addTicker('v1.7.1 / compact lumen refine');})();
</script>

</body>
</html>
